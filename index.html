<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¾ã¤æ¯›ã‚¨ã‚¯ã‚¹ãƒ†ã‚µãƒ­ãƒ³ æ—¥å ±ãƒ»ç›®æ¨™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffeef7 0%, #ffe0f0 50%, #ffcce6 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 420px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .login-form, .main-content {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input[type="text"], input[type="password"], input[type="date"], input[type="number"], textarea, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ffe0f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 240, 250, 0.5);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff69b4;
            background: rgba(255, 240, 250, 0.8);
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.2);
        }
        
        .password-container {
            position: relative;
        }
        
        .password-container input {
            padding-right: 50px;
        }
        
        .password-container input[type="password"] {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 67%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #ff69b4;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            z-index: 10;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            touch-action: manipulation;
        }
        
        .btn:hover, .btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 20, 147, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #dda0dd 0%, #ba55d3 100%);
        }
        
        .btn.logout {
            background: linear-gradient(135deg, #ffa500 0%, #ff6347 100%);
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            background: rgba(255, 240, 250, 0.8);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
        }
        
        .tab {
            flex: 1;
            padding: 15px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .daily-entry {
            background: rgba(255, 240, 250, 0.3);
            border: 2px solid #ffe0f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .daily-entry h3 {
            color: #ff1493;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .calculation-display {
            background: linear-gradient(135deg, #e6ffe6 0%, #ccffcc 100%);
            border: 2px solid #90ee90;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .calculation-display h4 {
            color: #006400;
            margin-bottom: 5px;
        }
        
        .calculation-display .amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #006400;
        }
        
        .error {
            background: linear-gradient(135deg, #ffe6e6 0%, #ffcccc 100%);
            border: 2px solid #ff6b6b;
            color: #d32f2f;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .success {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .employee-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255, 240, 250, 0.3);
            border-radius: 15px;
            padding: 20px;
        }
        
        .employee-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ff69b4;
        }
        
        .employee-card h4 {
            color: #ff1493;
            margin-bottom: 10px;
        }
        
        .data-entry {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .new-employee-form {
            background: rgba(255, 240, 250, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .header {
                border-radius: 0;
            }
            
            .row {
                flex-direction: column;
                gap: 0;
            }
            
            .row .form-group {
                margin-bottom: 15px;
            }
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }
        
        .achievement-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .achievement-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff69b4 0%, #ff1493 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .achievement-item {
            background: rgba(255, 240, 250, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff69b4;
        }
        
        .achievement-title {
            font-weight: bold;
            color: #ff1493;
            margin-bottom: 5px;
        }
        
        .achievement-rate {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’• ã¾ã¤æ¯›ã‚¨ã‚¯ã‚¹ãƒ†ã‚µãƒ­ãƒ³</h1>
            <p>æ—¥å ±ãƒ»ç›®æ¨™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>
        
        <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
        <div id="loginScreen" class="login-form">
            <div class="form-group">
                <label for="loginName">åå‰</label>
                <input type="text" id="loginName" placeholder="ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            </div>
            <div class="form-group">
                <div class="password-container">
                    <label for="loginPassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="loginPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">ğŸ‘ï¸</button>
                </div>
            </div>
            <button class="btn" onclick="employeeLogin()">ç¤¾å“¡ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button class="btn secondary" onclick="adminLogin()">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
            <div class="info-text">
                æ–°è¦ç¤¾å“¡ç™»éŒ²ã¯ç®¡ç†è€…ç”»é¢ã‹ã‚‰è¡Œãˆã¾ã™
            </div>
        </div>
        
        <!-- ç¤¾å“¡ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
        <div id="employeeMain" class="main-content hidden">
            <div class="tabs">
                <button class="tab active" onclick="showTab('dailyReport')">æ—¥å ±</button>
                <button class="tab" onclick="showTab('monthlyGoals')">ç›®æ¨™</button>
                <button class="tab" onclick="showTab('pastData')">å±¥æ­´</button>
                <button class="tab" onclick="showTab('monthlyAnalysis')">æœˆé–“é›†è¨ˆ</button>
            </div>
            
            <!-- æ—¥å ±å…¥åŠ› -->
            <div id="dailyReport" class="tab-content active">
                <div class="daily-entry">
                    <h3>ğŸ“ æ—¥å ±å…¥åŠ›</h3>
                    <div class="form-group">
                        <label for="reportDate">æ—¥ä»˜</label>
                        <input type="date" id="reportDate" onchange="updateGraphRealtime();">
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="techSales">æŠ€è¡“å£²ä¸Š (å††)</label>
                            <input type="number" id="techSales" placeholder="0" oninput="calculateTotal(); updateGraphRealtime();">
                        </div>
                        <div class="form-group">
                            <label for="productSales">åº—è²©å£²ä¸Š (å††)</label>
                            <input type="number" id="productSales" placeholder="0" oninput="calculateTotal(); updateGraphRealtime();">
                        </div>
                    </div>
                    <div class="calculation-display">
                        <h4>ç·å£²ä¸Š</h4>
                        <div class="amount" id="totalSalesDisplay">0 å††</div>
                    </div>
                    <div class="form-group">
                        <label for="nominations">æŒ‡åæ•°</label>
                        <input type="number" id="nominations" placeholder="0" oninput="updateGraphRealtime();">
                    </div>
                    <div class="form-group">
                        <label for="instagramUpdate">InstagramæŠ•ç¨¿æ›´æ–°</label>
                        <select id="instagramUpdate">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="æŠ•ç¨¿æ¸ˆã¿">æŠ•ç¨¿æ¸ˆã¿</option>
                            <option value="æœªæŠ•ç¨¿">æœªæŠ•ç¨¿</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tiktokUpdate">Instagramã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ›´æ–°</label>
                        <select id="tiktokUpdate">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="æŠ•ç¨¿æ¸ˆã¿">æŠ•ç¨¿æ¸ˆã¿</option>
                            <option value="æœªæŠ•ç¨¿">æœªæŠ•ç¨¿</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="blogUpdate">ãƒ–ãƒ­ã‚°æ›´æ–°</label>
                        <select id="blogUpdate">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="æ›´æ–°æ¸ˆã¿">æ›´æ–°æ¸ˆã¿</option>
                            <option value="æœªæ›´æ–°">æœªæ›´æ–°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="insights">æ°—ã¥ããƒ»ãƒ¡ãƒ¢</label>
                        <textarea id="insights" placeholder="ä»Šæ—¥ã®æ°—ã¥ãã‚„åçœç‚¹ãªã©ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
                    </div>
                    <button class="btn" onclick="saveDailyReport()">æ—¥å ±ã‚’ä¿å­˜</button>
                </div>
            </div>
            
            <!-- æœˆé–“ç›®æ¨™è¨­å®š -->
            <div id="monthlyGoals" class="tab-content">
                <div class="daily-entry">
                    <h3>ğŸ¯ æœˆé–“ç›®æ¨™è¨­å®š</h3>
                    <div class="form-group">
                        <label for="goalMonth">å¯¾è±¡æœˆ</label>
                        <input type="month" id="goalMonth">
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="techSalesGoal">æŠ€è¡“å£²ä¸Šç›®æ¨™ (å††)</label>
                            <input type="number" id="techSalesGoal" placeholder="0" oninput="calculateGoalTotal()">
                        </div>
                        <div class="form-group">
                            <label for="productSalesGoal">åº—è²©å£²ä¸Šç›®æ¨™ (å††)</label>
                            <input type="number" id="productSalesGoal" placeholder="0" oninput="calculateGoalTotal()">
                        </div>
                    </div>
                    <div class="calculation-display">
                        <h4>å£²ä¸Šç›®æ¨™ï¼ˆåˆè¨ˆï¼‰</h4>
                        <div class="amount" id="totalGoalDisplay">0 å††</div>
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="nominationGoal">æŒ‡åæ•°ç›®æ¨™</label>
                            <input type="number" id="nominationGoal" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workDaysGoal">å‡ºå‹¤äºˆå®šæ—¥æ•°</label>
                        <input type="number" id="workDaysGoal" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="goalText">ç›®æ¨™æ–‡ç« </label>
                        <textarea id="goalText" placeholder="ä»Šæœˆã®ç›®æ¨™ã‚„æ„æ°—è¾¼ã¿ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
                    </div>
                    <button class="btn" onclick="saveMonthlyGoals()">ç›®æ¨™ã‚’ä¿å­˜</button>
                </div>
            </div>
            
            <!-- éå»ãƒ‡ãƒ¼ã‚¿é–²è¦§ãƒ»ä¿®æ­£ -->
            <div id="pastData" class="tab-content">
                <h3>ğŸ“‹ éå»ã®æ—¥å ±ä¸€è¦§</h3>
                <div class="form-group">
                    <label for="historyMonth">è¡¨ç¤ºæœˆ</label>
                    <input type="month" id="historyMonth" onchange="loadHistoryData()">
                </div>
                <div id="historyDataDisplay"></div>
            </div>
            
            <!-- æœˆé–“é›†è¨ˆã‚¿ãƒ– -->
            <div id="monthlyAnalysis" class="tab-content">
                <h3>ğŸ“Š æœˆé–“é›†è¨ˆãƒ»åˆ†æ</h3>
                <div class="form-group">
                    <label for="summaryMonth">è¡¨ç¤ºæœˆ</label>
                    <input type="month" id="summaryMonth" onchange="loadSummaryData(); generateSimpleChart();">
                </div>
                
                <!-- æœˆé–“é›†è¨ˆè¡¨ç¤º -->
                <div id="monthlySummaryDisplay"></div>
                
                <!-- éå»ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒã‚¨ãƒªã‚¢ -->
                <div id="comparisonArea"></div>
                
                <!-- 12ãƒ¶æœˆå£²ä¸Šæ¨ç§»ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div id="chartSection" style="background: white; border-radius: 15px; padding: 20px; margin: 20px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h4 style="color: #ff1493; margin-bottom: 15px; text-align: center;">ğŸ“ˆ å£²ä¸Šæ¨ç§»ã‚°ãƒ©ãƒ•</h4>
                    
                    <!-- æœŸé–“é¸æŠ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn" style="width: auto; padding: 10px 15px; font-size: 14px;" onclick="generateSimpleChart()">ã‚°ãƒ©ãƒ•è¡¨ç¤º</button>
                            <button class="btn secondary" style="width: auto; padding: 10px 15px; font-size: 14px;" onclick="toggleChartType()">æœŸé–“é¸æŠ</button>
                        </div>
                        
                        <!-- ã‚«ã‚¹ã‚¿ãƒ æœŸé–“é¸æŠ -->
                        <div id="customPeriodSelector" style="display: none; margin-top: 15px;">
                            <div style="display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;">
                                <label style="font-size: 0.9em;">é–‹å§‹æœˆ:</label>
                                <input type="month" id="chartStartMonth" style="width: 150px;">
                                <label style="font-size: 0.9em;">çµ‚äº†æœˆ:</label>
                                <input type="month" id="chartEndMonth" style="width: 150px;">
                                <button class="btn secondary" style="width: auto; padding: 8px 15px; font-size: 14px;" onclick="generateCustomChart()">è¡¨ç¤º</button>
                            </div>
                        </div>
                        
                        <!-- ã‚°ãƒ©ãƒ•è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                        <div id="chartControls" style="margin-top: 15px; padding: 10px; background: rgba(255, 20, 147, 0.05); border-radius: 8px;">
                            <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #ff1493; font-size: 14px;">ğŸ“Š è¡¨ç¤ºé …ç›®é¸æŠ</div>
                            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showTotalSales" checked onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #ff1493; font-weight: bold;">â– </span> ç·å£²ä¸Š
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showTechSales" onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #4ecdc4; font-weight: bold;">â– </span> æŠ€è¡“å£²ä¸Š
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showProductSales" onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #ffa500; font-weight: bold;">â– </span> åº—è²©å£²ä¸Š
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <div id="chartContainer">
                        <!-- Chart.jsç‰ˆï¼ˆéè¡¨ç¤ºï¼‰ -->
                        <canvas id="salesTrendChart" style="height: 400px; display: none;"></canvas>
                        
                        <!-- HTML/CSSç‰ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• -->
                        <div id="simpleSalesChart" style="display: block;">
                            <!-- ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒ†ãƒŠï¼ˆå›ºå®šå¹…ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã—ã€12ãƒ¶æœˆè¡¨ç¤ºï¼‰ -->
                            <div style="padding: 5px; width: 100%; overflow: hidden;">
                                <div id="lineChartContainer" style="position: relative; height: 340px; background: #fafafa; border-radius: 10px; border-bottom: 2px solid #ff1493; width: 100%; max-width: 420px; margin: 0 auto;">
                                    <!-- ã‚°ãƒªãƒƒãƒ‰ç·šï¼ˆèƒŒæ™¯ï¼‰ã¨ç›®æ¨™ç·š -->
                                    <div id="gridLines" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
                                        <!-- é€šå¸¸ã®ã‚°ãƒªãƒƒãƒ‰ç·š -->
                                        <div style="position: absolute; top: 20%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 40%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 60%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 80%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <!-- ç›®æ¨™ç·šï¼ˆ50ä¸‡å††ãƒ»70ä¸‡å††ï¼‰ -->
                                        <div id="targetLine500k" style="position: absolute; left: 15px; right: 15px; height: 2px; background: #ff6b6b; opacity: 0.8; display: none;"></div>
                                        <div id="targetLine700k" style="position: absolute; left: 15px; right: 15px; height: 2px; background: #4ecdc4; opacity: 0.8; display: none;"></div>
                                        <!-- ç›®æ¨™ç·šãƒ©ãƒ™ãƒ« -->
                                        <div id="targetLabel500k" style="position: absolute; right: 20px; font-size: 10px; color: #ff6b6b; font-weight: bold; display: none;">50ä¸‡</div>
                                        <div id="targetLabel700k" style="position: absolute; right: 20px; font-size: 10px; color: #4ecdc4; font-weight: bold; display: none;">70ä¸‡</div>
                                    </div>
                                    
                                    <!-- SVGã§æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• -->
                                    <svg id="lineSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                                        <polyline id="salesLine" fill="none" stroke="#ff1493" stroke-width="3" points=""></polyline>
                                        <polyline id="techSalesLine" fill="none" stroke="#4ecdc4" stroke-width="2" points="" style="display: none;"></polyline>
                                        <polyline id="productSalesLine" fill="none" stroke="#ffa500" stroke-width="2" points="" style="display: none;"></polyline>
                                    </svg>
                                    
                                    <!-- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ -->
                                    <div id="dataPoints" style="position: relative; height: 100%;"></div>
                                    
                                    <!-- æœˆãƒ©ãƒ™ãƒ« -->
                                    <div id="monthLabels" style="position: absolute; bottom: 15px; left: 0; right: 0; height: 20px;"></div>
                                </div>
                            </div>
                            
                            <!-- é¸æŠã—ãŸæœˆã®è©³ç´°è¡¨ç¤º -->
                            <div id="selectedMonthInfo" style="margin-top: 15px; padding: 15px; background: rgba(255, 20, 147, 0.1); border-radius: 10px; text-align: center; min-height: 50px;">
                                <div style="color: #ff1493; font-weight: bold;">ã‚°ãƒ©ãƒ•ä¸Šã®ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†æ©Ÿèƒ½ -->
            <div style="margin: 20px 0; padding: 15px; background: rgba(255, 165, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffa500;">
                <div style="font-weight: bold; color: #ffa500; margin-bottom: 10px;">ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn secondary" onclick="exportAllData()" style="flex: 1; min-width: 120px;">
                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                    </button>
                    <label class="btn secondary" style="flex: 1; min-width: 120px; cursor: pointer; text-align: center;">
                        ğŸ“‚ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
                        <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                    </label>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 8px;">
                    ğŸ’¡ å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°æ™‚ã«å¾©å…ƒã—ã¦ãã ã•ã„
                </div>
            </div>

            <button class="sync-button" onclick="manualSync()">ğŸ”„ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿åŒæœŸ</button>
            <button class="btn logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
        
        <!-- ç®¡ç†è€…ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
        <div id="adminMain" class="main-content hidden">
            <div class="tabs">
                <button class="tab active" onclick="showAdminTab('allEmployees')">å…¨ç¤¾å“¡ãƒ‡ãƒ¼ã‚¿</button>
                <button class="tab" onclick="showAdminTab('newEmployee')">æ–°è¦ç™»éŒ²</button>
            </div>
            
            <!-- å…¨ç¤¾å“¡ãƒ‡ãƒ¼ã‚¿é–²è¦§ -->
            <div id="allEmployees" class="tab-content active">
                <h3>ğŸ‘¥ å…¨ç¤¾å“¡ãƒ‡ãƒ¼ã‚¿</h3>
                <div class="form-group">
                    <label for="adminDataMonth">è¡¨ç¤ºæœˆ</label>
                    <input type="month" id="adminDataMonth" onchange="loadAllEmployeeData()">
                </div>
                <div id="allEmployeeDataDisplay" class="employee-list"></div>
            </div>
            
            <!-- æ–°è¦ç¤¾å“¡ç™»éŒ² -->
            <div id="newEmployee" class="tab-content">
                <div class="new-employee-form">
                    <h3>â• æ–°è¦ç¤¾å“¡ç™»éŒ²</h3>
                    <div class="form-group">
                        <label for="newEmployeeName">ç¤¾å“¡å</label>
                        <input type="text" id="newEmployeeName" placeholder="ç¤¾å“¡åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    </div>
                    <div class="form-group">
                        <div class="password-container">
                            <label for="newEmployeePassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                            <input type="password" id="newEmployeePassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                            <button type="button" class="password-toggle" onclick="togglePassword('newEmployeePassword')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <button class="btn" onclick="registerNewEmployee()">ç¤¾å“¡ã‚’ç™»éŒ²</button>
                </div>
            </div>
            
            <button class="sync-button" onclick="manualSync()">ğŸ”„ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿åŒæœŸ</button>
            <button class="btn logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let isAdmin = false;

        // åˆæœŸè¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            const currentMonth = todayString.substring(0, 7);
            
            if (document.getElementById('reportDate')) {
                document.getElementById('reportDate').value = todayString;
            }
            if (document.getElementById('goalMonth')) {
                document.getElementById('goalMonth').value = currentMonth;
            }
            if (document.getElementById('historyMonth')) {
                document.getElementById('historyMonth').value = currentMonth;
            }
            if (document.getElementById('summaryMonth')) {
                document.getElementById('summaryMonth').value = currentMonth;
            }
            if (document.getElementById('adminDataMonth')) {
                document.getElementById('adminDataMonth').value = currentMonth;
            }
        });

        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentElement.querySelector('.password-toggle');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                button.textContent = 'ğŸ‘ï¸';
            }
        }

        // ç¤¾å“¡ãƒ­ã‚°ã‚¤ãƒ³
        function employeeLogin() {
            const name = document.getElementById('loginName').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!name || !password) {
                alert('åå‰ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const employees = getEmployees();
            const employee = employees.find(emp => emp.name === name && emp.password === password);
            
            if (employee) {
                currentUser = name;
                isAdmin = false;
                showScreen('employeeMain');
                loadPastData();
            } else {
                alert('åå‰ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
            }
        }

        // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
        function adminLogin() {
            const password = document.getElementById('loginPassword').value;
            
            if (password === 'admin123') {
                currentUser = 'admin';
                isAdmin = true;
                showScreen('adminMain');
                loadAllEmployeeData();
            } else {
                alert('ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
            }
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenId) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('employeeMain').classList.add('hidden');
            document.getElementById('adminMain').classList.add('hidden');
            
            document.getElementById(screenId).classList.remove('hidden');
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (screenId === 'loginScreen') {
                document.getElementById('loginName').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆç¤¾å“¡ï¼‰
        function showTab(tabName) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'pastData') {
                loadHistoryData();
            } else if (tabName === 'monthlyAnalysis') {
                loadSummaryData();
                // ã‚¿ãƒ–è¡¨ç¤ºå¾Œå°‘ã—é…å»¶ã—ã¦ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                setTimeout(() => {
                    generateSimpleChart();
                }, 200);
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆç®¡ç†è€…ï¼‰
        function showAdminTab(tabName) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('#adminMain .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('#adminMain .tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'allEmployees') {
                loadAllEmployeeData();
            }
        }

        // å£²ä¸Šåˆè¨ˆè¨ˆç®—
        function calculateTotal() {
            const techSales = parseFloat(document.getElementById('techSales').value) || 0;
            const productSales = parseFloat(document.getElementById('productSales').value) || 0;
            const total = techSales + productSales;
            
            document.getElementById('totalSalesDisplay').textContent = total.toLocaleString() + ' å††';
        }

        // ç›®æ¨™å£²ä¸Šåˆè¨ˆè¨ˆç®—
        function calculateGoalTotal() {
            const techSalesGoal = parseFloat(document.getElementById('techSalesGoal').value) || 0;
            const productSalesGoal = parseFloat(document.getElementById('productSalesGoal').value) || 0;
            const total = techSalesGoal + productSalesGoal;
            
            document.getElementById('totalGoalDisplay').textContent = total.toLocaleString() + ' å††';
        }

        // ç¤¾å“¡ãƒ‡ãƒ¼ã‚¿å–å¾—/ä¿å­˜
        function getEmployees() {
            const stored = localStorage.getItem('lashSalonEmployees');
            return stored ? JSON.parse(stored) : [];
        }

        function saveEmployees(employees) {
            localStorage.setItem('lashSalonEmployees', JSON.stringify(employees));
        }

        // æ—¥å ±ä¿å­˜
        function saveDailyReport() {
            const reportData = {
                date: document.getElementById('reportDate').value,
                techSales: parseFloat(document.getElementById('techSales').value) || 0,
                productSales: parseFloat(document.getElementById('productSales').value) || 0,
                totalSales: (parseFloat(document.getElementById('techSales').value) || 0) + (parseFloat(document.getElementById('productSales').value) || 0),
                nominations: parseInt(document.getElementById('nominations').value) || 0,
                instagramUpdate: document.getElementById('instagramUpdate').value,
                tiktokUpdate: document.getElementById('tiktokUpdate').value,
                blogUpdate: document.getElementById('blogUpdate').value,
                insights: document.getElementById('insights').value,
                timestamp: new Date().toISOString()
            };
            
            if (!reportData.date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // å£²ä¸Šã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
            if (reportData.techSales < 0 || reportData.productSales < 0) {
                alert('å£²ä¸Šé‡‘é¡ã¯0ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const key = `dailyReport_${currentUser}_${reportData.date}`;
            
            // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆä¿®æ­£ã®å ´åˆï¼‰
            const existingData = localStorage.getItem(key);
            if (existingData) {
                const existing = JSON.parse(existingData);
                // ä¿®æ­£å±¥æ­´ã‚’è¿½åŠ 
                if (!existing.modificationHistory) {
                    existing.modificationHistory = [];
                }
                reportData.modificationHistory = existing.modificationHistory;
                reportData.modificationHistory.push(`${new Date().toLocaleString('ja-JP')} ã«ä¿®æ­£`);
                reportData.originalTimestamp = existing.timestamp; // å…ƒã®ä½œæˆæ—¥æ™‚ã‚’ä¿æŒ
            }
            
            localStorage.setItem(key, JSON.stringify(reportData));
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showMessage('æ—¥å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
            updateGraphRealtime();
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('techSales').value = '';
            document.getElementById('productSales').value = '';
            document.getElementById('nominations').value = '';
            document.getElementById('instagramUpdate').value = '';
            document.getElementById('tiktokUpdate').value = '';
            document.getElementById('blogUpdate').value = '';
            document.getElementById('insights').value = '';
            calculateTotal();
        }

        // æœˆé–“ç›®æ¨™ä¿å­˜
        function saveMonthlyGoals() {
            const techSalesGoal = parseFloat(document.getElementById('techSalesGoal').value) || 0;
            const productSalesGoal = parseFloat(document.getElementById('productSalesGoal').value) || 0;
            
            const goalData = {
                month: document.getElementById('goalMonth').value,
                salesGoal: techSalesGoal + productSalesGoal, // è‡ªå‹•è¨ˆç®—ã•ã‚ŒãŸåˆè¨ˆå€¤
                techSalesGoal: techSalesGoal,
                productSalesGoal: productSalesGoal,
                nominationGoal: parseInt(document.getElementById('nominationGoal').value) || 0,
                workDaysGoal: parseInt(document.getElementById('workDaysGoal').value) || 0,
                goalText: document.getElementById('goalText').value,
                timestamp: new Date().toISOString()
            };
            
            if (!goalData.month) {
                alert('å¯¾è±¡æœˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const key = `monthlyGoals_${currentUser}_${goalData.month}`;
            localStorage.setItem(key, JSON.stringify(goalData));
            
            showMessage('æœˆé–“ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
            updateGraphRealtime();
        }

        // æœˆé–“é›†è¨ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadSummaryData() {
            const month = document.getElementById('summaryMonth').value;
            if (!month) return;
            
            const summaryDisplay = document.getElementById('monthlySummaryDisplay');
            summaryDisplay.innerHTML = '';
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${month}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            reports.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // æœˆé–“é›†è¨ˆã®è¨ˆç®—ã¨è¡¨ç¤º
            if (reports.length > 0) {
                let totalSales = 0;
                let totalTechSales = 0;
                let totalProductSales = 0;
                let totalNominations = 0;
                let instagramCount = 0;
                let tiktokCount = 0;
                let blogCount = 0;
                
                reports.forEach(report => {
                    totalSales += report.totalSales;
                    totalTechSales += report.techSales;
                    totalProductSales += report.productSales;
                    totalNominations += report.nominations;
                    
                    // SNSæ›´æ–°å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ
                    if (report.instagramUpdate === 'æŠ•ç¨¿æ¸ˆã¿') instagramCount++;
                    if (report.tiktokUpdate === 'æŠ•ç¨¿æ¸ˆã¿') tiktokCount++;
                    if (report.blogUpdate === 'æ›´æ–°æ¸ˆã¿') blogCount++;
                });
                
                // SNSæ›´æ–°ç‡è¨ˆç®—
                const instagramRate = reports.length > 0 ? ((instagramCount / reports.length) * 100).toFixed(1) : 0;
                const tiktokRate = reports.length > 0 ? ((tiktokCount / reports.length) * 100).toFixed(1) : 0;
                const blogRate = reports.length > 0 ? ((blogCount / reports.length) * 100).toFixed(1) : 0;
                
                // æœˆé–“ç›®æ¨™ã®å–å¾—ã¨é”æˆç‡åˆ†æ
                const goalKey = `monthlyGoals_${currentUser}_${month}`;
                const goalData = localStorage.getItem(goalKey);
                let achievementHTML = '';
                
                if (goalData) {
                    const goals = JSON.parse(goalData);
                    const salesAchievement = goals.salesGoal > 0 ? ((totalSales / goals.salesGoal) * 100) : 0;
                    const techAchievement = goals.techSalesGoal > 0 ? ((totalTechSales / goals.techSalesGoal) * 100) : 0;
                    const productAchievement = goals.productSalesGoal > 0 ? ((totalProductSales / goals.productSalesGoal) * 100) : 0;
                    const nominationAchievement = goals.nominationGoal > 0 ? ((totalNominations / goals.nominationGoal) * 100) : 0;
                    
                    achievementHTML = `
                        <div class="employee-card">
                            <h4>ğŸ¯ é”æˆç‡åˆ†æ</h4>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">ç·å£²ä¸Šé”æˆç‡</div>
                                <div class="achievement-rate">${salesAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(salesAchievement, 100)}%"></div>
                                </div>
                                <small>${totalSales.toLocaleString()}å†† / ${goals.salesGoal.toLocaleString()}å††</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">æŠ€è¡“å£²ä¸Šé”æˆç‡</div>
                                <div class="achievement-rate">${techAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(techAchievement, 100)}%"></div>
                                </div>
                                <small>${totalTechSales.toLocaleString()}å†† / ${goals.techSalesGoal.toLocaleString()}å††</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">åº—è²©å£²ä¸Šé”æˆç‡</div>
                                <div class="achievement-rate">${productAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(productAchievement, 100)}%"></div>
                                </div>
                                <small>${totalProductSales.toLocaleString()}å†† / ${goals.productSalesGoal.toLocaleString()}å††</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">æŒ‡åæ•°é”æˆç‡</div>
                                <div class="achievement-rate">${nominationAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(nominationAchievement, 100)}%"></div>
                                </div>
                                <small>${totalNominations}ä»¶ / ${goals.nominationGoal}ä»¶</small>
                            </div>
                        </div>
                    `;
                } else {
                    achievementHTML = `
                        <div class="employee-card">
                            <h4>ğŸ¯ é”æˆç‡åˆ†æ</h4>
                            <div class="info-text">
                                ã“ã®æœˆã®ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
                                ã€Œç›®æ¨™ã€ã‚¿ãƒ–ã‹ã‚‰æœˆé–“ç›®æ¨™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
                            </div>
                        </div>
                    `;
                }
                
                summaryDisplay.innerHTML = `
                    <div class="employee-card">
                        <h4>ğŸ“Š æœˆé–“å®Ÿç¸¾ã‚µãƒãƒªãƒ¼</h4>
                        <div class="data-entry"><strong>ç·å£²ä¸Š: ${totalSales.toLocaleString()}å††</strong></div>
                        <div class="data-entry">æŠ€è¡“å£²ä¸Š: ${totalTechSales.toLocaleString()}å††</div>
                        <div class="data-entry">åº—è²©å£²ä¸Š: ${totalProductSales.toLocaleString()}å††</div>
                        <div class="data-entry">æŒ‡åæ•°: ${totalNominations}ä»¶</div>
                        <div class="data-entry">å…¥åŠ›æ—¥æ•°: ${reports.length}æ—¥</div>
                    </div>
                    
                    <div class="employee-card">
                        <h4>ğŸ“± SNSæ›´æ–°ç‡</h4>
                        <div class="achievement-item">
                            <div class="achievement-title">InstagramæŠ•ç¨¿æ›´æ–°ç‡</div>
                            <div class="achievement-rate">${instagramRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${instagramRate}%"></div>
                            </div>
                            <small>${instagramCount}å› / ${reports.length}æ—¥</small>
                        </div>
                        
                        <div class="achievement-item">
                            <div class="achievement-title">Instagramã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ›´æ–°ç‡</div>
                            <div class="achievement-rate">${tiktokRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${tiktokRate}%"></div>
                            </div>
                            <small>${tiktokCount}å› / ${reports.length}æ—¥</small>
                        </div>
                        
                        <div class="achievement-item">
                            <div class="achievement-title">ãƒ–ãƒ­ã‚°æ›´æ–°ç‡</div>
                            <div class="achievement-rate">${blogRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${blogRate}%"></div>
                            </div>
                            <small>${blogCount}å› / ${reports.length}æ—¥</small>
                        </div>
                    </div>
                    
                    ${achievementHTML}
                `;
                
                // éå»ãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒã‚’ç”Ÿæˆ
                generateComparison(month, totalSales, totalTechSales, totalProductSales, totalNominations, instagramRate, tiktokRate, blogRate);
                
                // åˆæœŸã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ï¼‰
                initializeChart(month);
            }
            
            if (reports.length === 0) {
                summaryDisplay.innerHTML = '<div class="info-text">ã“ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã§ã‚‚åˆæœŸã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤º
                const month = document.getElementById('summaryMonth').value || new Date().toISOString().substr(0, 7);
                initializeChart(month);
                return;
            }
        }


        // å±¥æ­´ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆæ–°ã—ã„å±¥æ­´ã‚¿ãƒ–ç”¨ï¼‰
        function loadHistoryData() {
            const month = document.getElementById('historyMonth').value;
            if (!month) return;
            
            const display = document.getElementById('historyDataDisplay');
            display.innerHTML = '';
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${month}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            reports.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (reports.length === 0) {
                display.innerHTML = '<div class="info-text">ã“ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                return;
            }
            
            reports.forEach(report => {
                const reportDiv = document.createElement('div');
                reportDiv.className = 'employee-card';
                
                // ä¿®æ­£å±¥æ­´ã®è¡¨ç¤º
                let modificationHistory = '';
                if (report.modificationHistory && report.modificationHistory.length > 0) {
                    modificationHistory = `
                        <div class="data-entry" style="color: #888; font-size: 0.8em;">
                            ä¿®æ­£å±¥æ­´: ${report.modificationHistory[report.modificationHistory.length - 1]}
                        </div>
                    `;
                }
                
                reportDiv.innerHTML = `
                    <h4>ğŸ“… ${new Date(report.date).toLocaleDateString('ja-JP')}</h4>
                    <div class="data-entry">æŠ€è¡“å£²ä¸Š: ${report.techSales.toLocaleString()}å††</div>
                    <div class="data-entry">åº—è²©å£²ä¸Š: ${report.productSales.toLocaleString()}å††</div>
                    <div class="data-entry">ç·å£²ä¸Š: ${report.totalSales.toLocaleString()}å††</div>
                    <div class="data-entry">æŒ‡åæ•°: ${report.nominations}ä»¶</div>
                    <div class="data-entry">Instagram: ${report.instagramUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div class="data-entry">TikTok: ${report.tiktokUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div class="data-entry">ãƒ–ãƒ­ã‚°: ${report.blogUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div class="data-entry">æ°—ã¥ã: ${report.insights || 'æœªè¨˜éŒ²'}</div>
                    ${modificationHistory}
                    <button class="btn secondary" onclick="editReport('${report.date}')">ä¿®æ­£</button>
                `;
                display.appendChild(reportDiv);
            });
        }

        // å ±å‘Šæ›¸ä¿®æ­£
        function editReport(date) {
            const key = `dailyReport_${currentUser}_${date}`;
            const report = JSON.parse(localStorage.getItem(key));
            
            if (!report) return;
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
            document.getElementById('reportDate').value = report.date;
            document.getElementById('techSales').value = report.techSales;
            document.getElementById('productSales').value = report.productSales;
            document.getElementById('nominations').value = report.nominations;
            document.getElementById('instagramUpdate').value = report.instagramUpdate || '';
            document.getElementById('tiktokUpdate').value = report.tiktokUpdate || '';
            document.getElementById('blogUpdate').value = report.blogUpdate || '';
            document.getElementById('insights').value = report.insights || '';
            
            calculateTotal();
            
            // æ—¥å ±ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('button[onclick="showTab(\'dailyReport\')"]').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('dailyReport').classList.add('active');
            
            showMessage('ä¿®æ­£ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ç·¨é›†ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚', 'success');
        }

        // å…¨ç¤¾å“¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function loadAllEmployeeData() {
            const month = document.getElementById('adminDataMonth').value;
            if (!month) return;
            
            const display = document.getElementById('allEmployeeDataDisplay');
            display.innerHTML = '';
            
            const employees = getEmployees();
            if (employees.length === 0) {
                display.innerHTML = '<div class="info-text">ç™»éŒ²ã•ã‚ŒãŸç¤¾å“¡ãŒã„ã¾ã›ã‚“ã€‚</div>';
                return;
            }
            
            employees.forEach(employee => {
                const employeeData = [];
                
                // è©²å½“æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(`dailyReport_${employee.name}_${month}`)) {
                        const data = JSON.parse(localStorage.getItem(key));
                        employeeData.push(data);
                    }
                }
                
                employeeData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const employeeDiv = document.createElement('div');
                employeeDiv.className = 'employee-card';
                
                let totalSales = 0;
                let totalTechSales = 0;
                let totalProductSales = 0;
                let totalNominations = 0;
                
                employeeData.forEach(data => {
                    totalSales += data.totalSales;
                    totalTechSales += data.techSales;
                    totalProductSales += data.productSales;
                    totalNominations += data.nominations;
                });
                
                let dataHTML = `<h4>ğŸ‘¤ ${employee.name}</h4>`;
                dataHTML += `<div class="data-entry"><strong>æœˆé–“åˆè¨ˆ - ç·å£²ä¸Š: ${totalSales.toLocaleString()}å†† | æŠ€è¡“å£²ä¸Š: ${totalTechSales.toLocaleString()}å†† | åº—è²©å£²ä¸Š: ${totalProductSales.toLocaleString()}å†† | æŒ‡åæ•°: ${totalNominations}ä»¶</strong></div>`;
                
                if (employeeData.length === 0) {
                    dataHTML += '<div class="data-entry">ã“ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                } else {
                    employeeData.forEach(data => {
                        dataHTML += `
                            <div class="data-entry" style="cursor: pointer; background: rgba(255, 105, 180, 0.1); border-radius: 8px; margin: 5px 0; padding: 10px;" onclick="showReportDetails('${employee.name}', '${data.date}')">
                                ğŸ“… ${new Date(data.date).toLocaleDateString('ja-JP')} - 
                                ç·å£²ä¸Š: ${data.totalSales.toLocaleString()}å†† | 
                                æŒ‡åæ•°: ${data.nominations}ä»¶
                                <small style="display: block; color: #888; margin-top: 5px;">ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º</small>
                            </div>
                        `;
                    });
                }
                
                employeeDiv.innerHTML = dataHTML;
                display.appendChild(employeeDiv);
            });
        }

        // æ—¥å ±è©³ç´°è¡¨ç¤ºï¼ˆç®¡ç†è€…ç”¨ï¼‰
        function showReportDetails(employeeName, date) {
            const key = `dailyReport_${employeeName}_${date}`;
            const report = JSON.parse(localStorage.getItem(key));
            
            if (!report) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                return;
            }
            
            const detailsHTML = `
                <div style="background: white; border-radius: 15px; padding: 20px; margin: 10px 0; border: 2px solid #ff69b4;">
                    <h4 style="color: #ff1493; margin-bottom: 15px;">ğŸ“‹ ${employeeName}ã•ã‚“ã®æ—¥å ±è©³ç´° - ${new Date(report.date).toLocaleDateString('ja-JP')}</h4>
                    <div style="margin-bottom: 10px;"><strong>æŠ€è¡“å£²ä¸Š:</strong> ${report.techSales.toLocaleString()}å††</div>
                    <div style="margin-bottom: 10px;"><strong>åº—è²©å£²ä¸Š:</strong> ${report.productSales.toLocaleString()}å††</div>
                    <div style="margin-bottom: 10px;"><strong>ç·å£²ä¸Š:</strong> ${report.totalSales.toLocaleString()}å††</div>
                    <div style="margin-bottom: 10px;"><strong>æŒ‡åæ•°:</strong> ${report.nominations}ä»¶</div>
                    <div style="margin-bottom: 10px;"><strong>Instagram:</strong> ${report.instagramUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div style="margin-bottom: 10px;"><strong>TikTok:</strong> ${report.tiktokUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div style="margin-bottom: 10px;"><strong>ãƒ–ãƒ­ã‚°:</strong> ${report.blogUpdate || 'æœªè¨˜éŒ²'}</div>
                    <div style="margin-bottom: 15px;"><strong>æ°—ã¥ããƒ»ãƒ¡ãƒ¢:</strong><br>${report.insights || 'æœªè¨˜éŒ²'}</div>
                    <div style="font-size: 0.8em; color: #888;">è¨˜éŒ²æ—¥æ™‚: ${new Date(report.timestamp).toLocaleString('ja-JP')}</div>
                    <button onclick="closeReportDetails()" style="margin-top: 15px; padding: 10px 20px; background: #ff69b4; color: white; border: none; border-radius: 8px; cursor: pointer;">é–‰ã˜ã‚‹</button>
                </div>
            `;
            
            // æ—¢å­˜ã®è©³ç´°è¡¨ç¤ºãŒã‚ã‚Œã°å‰Šé™¤
            const existingDetail = document.getElementById('reportDetail');
            if (existingDetail) {
                existingDetail.remove();
            }
            
            // è©³ç´°è¡¨ç¤ºã‚’æŒ¿å…¥
            const detailDiv = document.createElement('div');
            detailDiv.id = 'reportDetail';
            detailDiv.innerHTML = detailsHTML;
            
            const adminDisplay = document.getElementById('allEmployeeDataDisplay');
            adminDisplay.insertBefore(detailDiv, adminDisplay.firstChild);
            
            // è©³ç´°è¡¨ç¤ºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            detailDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // æ—¥å ±è©³ç´°ã‚’é–‰ã˜ã‚‹
        function closeReportDetails() {
            const detail = document.getElementById('reportDetail');
            if (detail) {
                detail.remove();
            }
        }

        // æ–°è¦ç¤¾å“¡ç™»éŒ²
        function registerNewEmployee() {
            const name = document.getElementById('newEmployeeName').value.trim();
            const password = document.getElementById('newEmployeePassword').value;
            
            if (!name || !password) {
                alert('ç¤¾å“¡åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const employees = getEmployees();
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (employees.find(emp => emp.name === name)) {
                alert('ã“ã®ç¤¾å“¡åã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚');
                return;
            }
            
            // æ–°è¦ç¤¾å“¡è¿½åŠ 
            employees.push({
                name: name,
                password: password,
                createdAt: new Date().toISOString()
            });
            
            saveEmployees(employees);
            
            showMessage('æ–°è¦ç¤¾å“¡ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼', 'success');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('newEmployeeName').value = '';
            document.getElementById('newEmployeePassword').value = '';
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é©åˆ‡ãªå ´æ‰€ã«æŒ¿å…¥
            const activeContent = document.querySelector('.tab-content.active') || document.querySelector('.main-content:not(.hidden)');
            if (activeContent) {
                activeContent.insertBefore(messageDiv, activeContent.firstChild);
                
                // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 3000);
            }
        }

        // éå»ãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒæ©Ÿèƒ½
        function generateComparison(currentMonth, totalSales, totalTechSales, totalProductSales, totalNominations, instagramRate, tiktokRate, blogRate) {
            const comparisonDisplay = document.getElementById('comparisonArea');
            
            // å‰æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const lastMonthData = getLastMonthData(currentMonth);
            
            // éå»1å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const yearlyData = getYearlyData(currentMonth);
            
            let comparisonHTML = '';
            
            // å‰æœˆã¨ã®æ¯”è¼ƒ
            if (lastMonthData) {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>ğŸ“Š å‰æœˆã¨ã®æ¯”è¼ƒ</h4>
                        ${generateMonthComparison(lastMonthData, {
                            totalSales, totalTechSales, totalProductSales, totalNominations,
                            instagramRate, tiktokRate, blogRate
                        })}
                    </div>
                `;
            } else {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>ğŸ“Š å‰æœˆã¨ã®æ¯”è¼ƒ</h4>
                        <div class="info-text">
                            å‰æœˆã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                            2ãƒ¶æœˆç›®ä»¥é™ã‹ã‚‰æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                        </div>
                    </div>
                `;
            }
            
            // éå»1å¹´é–“ã¨ã®æ¯”è¼ƒ
            if (yearlyData.length > 0) {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>ğŸ“ˆ éå»1å¹´é–“ã¨ã®æ¯”è¼ƒ</h4>
                        ${generateYearlyComparison(yearlyData, {
                            totalSales, totalTechSales, totalProductSales, totalNominations,
                            instagramRate, tiktokRate, blogRate
                        })}
                    </div>
                `;
            } else {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>ğŸ“ˆ éå»1å¹´é–“ã¨ã®æ¯”è¼ƒ</h4>
                        <div class="info-text">
                            éå»1å¹´é–“ã®ãƒ‡ãƒ¼ã‚¿ãŒã¾ã è“„ç©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>
                            ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã¨è©³ç´°ãªå¹´é–“æ¯”è¼ƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                        </div>
                    </div>
                `;
            }
            
            comparisonDisplay.innerHTML = comparisonHTML;
        }
        
        // å‰æœˆãƒ‡ãƒ¼ã‚¿å–å¾—
        function getLastMonthData(currentMonth) {
            const currentDate = new Date(currentMonth + '-01');
            const lastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            const lastMonthStr = lastMonth.toISOString().substr(0, 7);
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${lastMonthStr}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            if (reports.length === 0) return null;
            
            let totalSales = 0, totalTechSales = 0, totalProductSales = 0, totalNominations = 0;
            let instagramCount = 0, tiktokCount = 0, blogCount = 0;
            
            reports.forEach(report => {
                totalSales += report.totalSales;
                totalTechSales += report.techSales;
                totalProductSales += report.productSales;
                totalNominations += report.nominations;
                
                if (report.instagramUpdate === 'æŠ•ç¨¿æ¸ˆã¿') instagramCount++;
                if (report.tiktokUpdate === 'æŠ•ç¨¿æ¸ˆã¿') tiktokCount++;
                if (report.blogUpdate === 'æ›´æ–°æ¸ˆã¿') blogCount++;
            });
            
            return {
                month: lastMonthStr,
                totalSales, totalTechSales, totalProductSales, totalNominations,
                instagramRate: ((instagramCount / reports.length) * 100).toFixed(1),
                tiktokRate: ((tiktokCount / reports.length) * 100).toFixed(1),
                blogRate: ((blogCount / reports.length) * 100).toFixed(1),
                workDays: reports.length
            };
        }
        
        // éå»1å¹´é–“ãƒ‡ãƒ¼ã‚¿å–å¾—
        function getYearlyData(currentMonth) {
            const currentDate = new Date(currentMonth + '-01');
            const yearlyData = [];
            
            for (let i = 1; i <= 12; i++) {
                const targetDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const targetMonthStr = targetDate.toISOString().substr(0, 7);
                
                const reports = [];
                for (let j = 0; j < localStorage.length; j++) {
                    const key = localStorage.key(j);
                    if (key.startsWith(`dailyReport_${currentUser}_${targetMonthStr}`)) {
                        const data = JSON.parse(localStorage.getItem(key));
                        reports.push(data);
                    }
                }
                
                if (reports.length > 0) {
                    let totalSales = 0, totalTechSales = 0, totalProductSales = 0, totalNominations = 0;
                    
                    reports.forEach(report => {
                        totalSales += report.totalSales;
                        totalTechSales += report.techSales;
                        totalProductSales += report.productSales;
                        totalNominations += report.nominations;
                    });
                    
                    yearlyData.push({
                        month: targetMonthStr,
                        totalSales, totalTechSales, totalProductSales, totalNominations,
                        workDays: reports.length
                    });
                }
            }
            
            return yearlyData.reverse();
        }
        
        // å‰æœˆæ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateMonthComparison(lastMonth, current) {
            const salesChange = current.totalSales - lastMonth.totalSales;
            const salesChangePercent = lastMonth.totalSales > 0 ? ((salesChange / lastMonth.totalSales) * 100).toFixed(1) : 0;
            
            const techChange = current.totalTechSales - lastMonth.totalTechSales;
            const techChangePercent = lastMonth.totalTechSales > 0 ? ((techChange / lastMonth.totalTechSales) * 100).toFixed(1) : 0;
            
            const productChange = current.totalProductSales - lastMonth.totalProductSales;
            const productChangePercent = lastMonth.totalProductSales > 0 ? ((productChange / lastMonth.totalProductSales) * 100).toFixed(1) : 0;
            
            const nominationChange = current.totalNominations - lastMonth.totalNominations;
            
            const getChangeColor = (value) => value >= 0 ? '#28a745' : '#dc3545';
            const getChangeIcon = (value) => value >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
            
            return `
                <div class="data-entry">
                    <strong>å‰æœˆ: ${new Date(lastMonth.month + '-01').toLocaleDateString('ja-JP', {year: 'numeric', month: 'long'})}</strong>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(salesChange)};">
                    ${getChangeIcon(salesChange)} ç·å£²ä¸Š: ${salesChange >= 0 ? '+' : ''}${salesChange.toLocaleString()}å†† (${salesChangePercent >= 0 ? '+' : ''}${salesChangePercent}%)
                    <br><small>å‰æœˆ: ${lastMonth.totalSales.toLocaleString()}å†† â†’ ä»Šæœˆ: ${current.totalSales.toLocaleString()}å††</small>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(techChange)};">
                    ${getChangeIcon(techChange)} æŠ€è¡“å£²ä¸Š: ${techChange >= 0 ? '+' : ''}${techChange.toLocaleString()}å†† (${techChangePercent >= 0 ? '+' : ''}${techChangePercent}%)
                </div>
                <div class="data-entry" style="color: ${getChangeColor(productChange)};">
                    ${getChangeIcon(productChange)} åº—è²©å£²ä¸Š: ${productChange >= 0 ? '+' : ''}${productChange.toLocaleString()}å†† (${productChangePercent >= 0 ? '+' : ''}${productChangePercent}%)
                </div>
                <div class="data-entry" style="color: ${getChangeColor(nominationChange)};">
                    ${getChangeIcon(nominationChange)} æŒ‡åæ•°: ${nominationChange >= 0 ? '+' : ''}${nominationChange}ä»¶
                </div>
            `;
        }
        
        // å¹´é–“æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateYearlyComparison(yearlyData, current) {
            const avgSales = yearlyData.reduce((sum, data) => sum + data.totalSales, 0) / yearlyData.length;
            const avgTechSales = yearlyData.reduce((sum, data) => sum + data.totalTechSales, 0) / yearlyData.length;
            const avgProductSales = yearlyData.reduce((sum, data) => sum + data.totalProductSales, 0) / yearlyData.length;
            const avgNominations = yearlyData.reduce((sum, data) => sum + data.totalNominations, 0) / yearlyData.length;
            
            const maxSales = Math.max(...yearlyData.map(data => data.totalSales));
            const minSales = Math.min(...yearlyData.map(data => data.totalSales));
            
            const salesVsAvg = current.totalSales - avgSales;
            const salesVsAvgPercent = avgSales > 0 ? ((salesVsAvg / avgSales) * 100).toFixed(1) : 0;
            
            const getChangeColor = (value) => value >= 0 ? '#28a745' : '#dc3545';
            const getChangeIcon = (value) => value >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
            
            return `
                <div class="data-entry">
                    <strong>éå»${yearlyData.length}ãƒ¶æœˆã®å¹³å‡ã¨ã®æ¯”è¼ƒ</strong>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(salesVsAvg)};">
                    ${getChangeIcon(salesVsAvg)} ç·å£²ä¸Š: å¹³å‡ã‚ˆã‚Š${salesVsAvg >= 0 ? '+' : ''}${salesVsAvg.toLocaleString()}å†† (${salesVsAvgPercent >= 0 ? '+' : ''}${salesVsAvgPercent}%)
                    <br><small>éå»å¹³å‡: ${avgSales.toLocaleString()}å††</small>
                </div>
                <div class="data-entry">
                    ğŸ“Š éå»æœ€é«˜: ${maxSales.toLocaleString()}å†† | æœ€ä½: ${minSales.toLocaleString()}å††
                </div>
                <div class="data-entry">
                    ğŸ“ˆ æŠ€è¡“å£²ä¸Šå¹³å‡: ${avgTechSales.toLocaleString()}å†† | åº—è²©å£²ä¸Šå¹³å‡: ${avgProductSales.toLocaleString()}å††
                </div>
                <div class="data-entry">
                    ğŸ¯ æŒ‡åæ•°å¹³å‡: ${avgNominations.toFixed(1)}ä»¶
                </div>
            `;
        }

        // ã‚°ãƒ©ãƒ•åˆæœŸåŒ–ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        function initializeChart(currentMonth) {
            console.log('ã‚·ãƒ³ãƒ—ãƒ«ã‚°ãƒ©ãƒ•åˆæœŸåŒ–é–‹å§‹:', currentMonth);
            
            // HTMLãƒãƒ£ãƒ¼ãƒˆã‚’ç›´æ¥æ›´æ–°
            setTimeout(() => {
                generateSimpleChart();
            }, 100);
        }
        
        // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ç”Ÿæˆï¼ˆéå»1å¹´åˆ†ï¼‰
        function generateSimpleChart() {
            console.log('æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ç”Ÿæˆé–‹å§‹');
            
            // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (!currentUser) {
                console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            // æœˆæ¬¡ã‚µãƒãƒªãƒ¼ã§é¸æŠä¸­ã®æœˆã‚’å–å¾—
            const selectedMonth = document.getElementById('summaryMonth')?.value || new Date().toISOString().substr(0, 7);
            console.log('é¸æŠä¸­ã®æœˆ:', selectedMonth);
            
            // éå»1å¹´åˆ†ã®å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆé¸æŠæœˆã‹ã‚‰é¡ã‚‹ï¼‰
            const yearlyData = [];
            
            if (selectedMonth && currentUser) {
                const currentDate = new Date(selectedMonth + '-01');
                
                // éå»12ãƒ¶æœˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆé¸æŠæœˆå«ã‚€ï¼‰
                for (let i = 11; i >= 0; i--) {
                    // æ­£ç¢ºãªæœˆè¨ˆç®—ã‚’è¡Œã†
                    const targetDate = new Date(currentDate);
                    targetDate.setMonth(currentDate.getMonth() - i);
                    const targetMonthStr = targetDate.toISOString().substr(0, 7);
                    const monthData = getMonthData(targetMonthStr);
                    
                    console.log(`æœˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ: i=${i}, ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæœˆ=${targetMonthStr}`);
                    
                    // å…¨ã¦ã®æœˆã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ¼ã‚¿ãŒãªã„æœˆã¯0ã¨ã—ã¦è¡¨ç¤ºï¼‰
                    yearlyData.push({
                        month: targetMonthStr,
                        monthName: targetDate.toLocaleDateString('ja-JP', {month: 'short'}),
                        fullDate: new Date(targetDate),
                        totalSales: monthData.totalSales,
                        totalTechSales: monthData.totalTechSales,
                        totalProductSales: monthData.totalProductSales,
                        nominations: monthData.totalNominations,
                        workDays: monthData.workDays
                    });
                }
            }
            
            console.log('å–å¾—ã—ãŸå¹´é–“ãƒ‡ãƒ¼ã‚¿:', yearlyData);
            
            if (yearlyData.length === 0) {
                const infoContainer = document.getElementById('selectedMonthInfo');
                if (infoContainer) {
                    infoContainer.innerHTML = 
                        '<div style="color: #ff1493; font-weight: bold;">è¡¨ç¤ºã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
                return;
            }
            
            // ã‚°ãƒ©ãƒ•è¦ç´ ã®å­˜åœ¨ç¢ºèª
            const container = document.getElementById('lineChartContainer');
            const svg = document.getElementById('lineSvg');
            const line = document.getElementById('salesLine');
            
            if (!container || !svg || !line) {
                console.error('ã‚°ãƒ©ãƒ•è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', {container: !!container, svg: !!svg, line: !!line});
                setTimeout(() => generateSimpleChart(), 100); // 100mså¾Œã«å†è©¦è¡Œ
                return;
            }
            
            // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚’æç”»
            drawLineChart(yearlyData);
        }
        
        // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•æç”»ï¼ˆå®‰å®šç‰ˆï¼‰
        function drawLineChart(data) {
            const container = document.getElementById('lineChartContainer');
            const svg = document.getElementById('lineSvg');
            const line = document.getElementById('salesLine');
            const dataPointsContainer = document.getElementById('dataPoints');
            const monthLabelsContainer = document.getElementById('monthLabels');
            
            if (!container || !svg || !line || !dataPointsContainer || !monthLabelsContainer) {
                console.error('ã‚°ãƒ©ãƒ•è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // æ—¢å­˜ã®è¦ç´ ã‚’ã‚¯ãƒªã‚¢
            dataPointsContainer.innerHTML = '';
            monthLabelsContainer.innerHTML = '';
            
            if (data.length === 0) {
                console.log('ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™');
                return;
            }
            
            console.log('ã‚°ãƒ©ãƒ•æç”»é–‹å§‹ã€ãƒ‡ãƒ¼ã‚¿æ•°:', data.length);
            
            // ã‚°ãƒ©ãƒ•è¨­å®šï¼ˆ12ãƒ¶æœˆã™ã¹ã¦ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«èª¿æ•´ï¼‰
            const padding = 25;
            const containerRect = container.getBoundingClientRect();
            const chartWidth = containerRect.width || 400;
            const chartHeight = 280;
            
            // æœ€å¤§å€¤ãƒ»æœ€å°å€¤ã‚’è¨ˆç®—ï¼ˆç›®æ¨™ç·šã‚‚å«ã‚ã¦ç¯„å›²è¨­å®šï¼‰
            const allValues = data.map(d => d.totalSales);
            const maxSales = Math.max(...allValues, 700000); // 70ä¸‡å††ã‚’æœ€ä½ã§ã‚‚å«ã‚€
            const minSales = Math.min(...allValues, 0);
            const salesRange = maxSales - minSales || 1;
            
            console.log(`å£²ä¸Šç¯„å›²: ${minSales.toLocaleString()} - ${maxSales.toLocaleString()}`);
            
            // ç›®æ¨™ç·šã®ä½ç½®ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
            const target500k = 500000;
            const target700k = 700000;
            
            if (target500k >= minSales && target500k <= maxSales) {
                const y500k = padding + ((maxSales - target500k) / salesRange) * (chartHeight - padding * 2);
                const targetLine500k = document.getElementById('targetLine500k');
                const targetLabel500k = document.getElementById('targetLabel500k');
                if (targetLine500k && targetLabel500k) {
                    targetLine500k.style.top = y500k + 'px';
                    targetLine500k.style.display = 'block';
                    targetLabel500k.style.top = (y500k - 15) + 'px';
                    targetLabel500k.style.display = 'block';
                }
            }
            
            if (target700k >= minSales && target700k <= maxSales) {
                const y700k = padding + ((maxSales - target700k) / salesRange) * (chartHeight - padding * 2);
                const targetLine700k = document.getElementById('targetLine700k');
                const targetLabel700k = document.getElementById('targetLabel700k');
                if (targetLine700k && targetLabel700k) {
                    targetLine700k.style.top = y700k + 'px';
                    targetLine700k.style.display = 'block';
                    targetLabel700k.style.top = (y700k - 15) + 'px';
                    targetLabel700k.style.display = 'block';
                }
            }
            
            // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ç·šã®åº§æ¨™ã‚’è¨ˆç®—ï¼ˆ12ãƒ¶æœˆãŒè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ï¼‰
            const points = [];
            const availableWidth = chartWidth - (padding * 2);
            const monthWidth = data.length > 1 ? availableWidth / (data.length - 1) : 0;
            
            data.forEach((item, index) => {
                const x = padding + (index * monthWidth);
                const y = padding + ((maxSales - item.totalSales) / salesRange) * (chartHeight - padding * 2);
                
                points.push(`${x},${y}`);
                
                // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆä½œæˆï¼ˆãƒ‡ãƒ¼ã‚¿ãŒãªã„æœˆã¯è–„ã„ã‚°ãƒ¬ãƒ¼è¡¨ç¤ºï¼‰
                const hasData = item.workDays > 0;
                const point = document.createElement('div');
                point.style.cssText = `
                    position: absolute;
                    left: ${x - 6}px;
                    top: ${y - 6}px;
                    width: 12px;
                    height: 12px;
                    background: ${hasData ? '#ff1493' : '#ddd'};
                    border: 3px solid white;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    opacity: ${hasData ? '1' : '0.6'};
                    z-index: 10;
                `;
                
                point.onclick = () => showMonthDetails(item);
                dataPointsContainer.appendChild(point);
                
                // æœˆãƒ©ãƒ™ãƒ«ä½œæˆï¼ˆè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«é…ç½®ï¼‰
                const labelWidth = Math.min(25, monthWidth * 0.8);
                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    left: ${x - labelWidth/2}px;
                    width: ${labelWidth}px;
                    text-align: center;
                    font-size: 10px;
                    color: #666;
                    font-weight: 500;
                `;
                label.textContent = item.monthName;
                monthLabelsContainer.appendChild(label);
            });
            
            // è¤‡æ•°ã®ç·šã®åº§æ¨™ã‚’è¨ˆç®—
            const techPoints = [];
            const productPoints = [];
            
            data.forEach((item, index) => {
                const x = padding + (index * monthWidth);
                const techY = padding + ((maxSales - item.totalTechSales) / salesRange) * (chartHeight - padding * 2);
                const productY = padding + ((maxSales - item.totalProductSales) / salesRange) * (chartHeight - padding * 2);
                
                techPoints.push(`${x},${techY}`);
                productPoints.push(`${x},${productY}`);
            });
            
            // å…¨ã¦ã®ç·šã‚’æ›´æ–°
            if (points.length > 0) {
                // ç·å£²ä¸Šç·šï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
                line.setAttribute('points', points.join(' '));
                
                // æŠ€è¡“å£²ä¸Šç·š
                const techLine = document.getElementById('techSalesLine');
                if (techLine && techPoints.length > 0) {
                    techLine.setAttribute('points', techPoints.join(' '));
                }
                
                // åº—è²©å£²ä¸Šç·š
                const productLine = document.getElementById('productSalesLine');
                if (productLine && productPoints.length > 0) {
                    productLine.setAttribute('points', productPoints.join(' '));
                }
                
                console.log('è¤‡æ•°SVGç·šã‚’æ›´æ–°:', points.length + 'ãƒã‚¤ãƒ³ãƒˆ');
            }
            
            // è¡¨ç¤ºè¨­å®šã‚’é©ç”¨
            updateGraphLines();
            
            console.log('è¤‡æ•°æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•æç”»å®Œäº†');
        }
        
        // æœˆè©³ç´°è¡¨ç¤º
        function showMonthDetails(monthData) {
            console.log('æœˆè©³ç´°è¡¨ç¤º:', monthData);
            const infoContainer = document.getElementById('selectedMonthInfo');
            const date = new Date(monthData.month + '-01');
            const formattedDate = date.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long'});
            
            // ç¾åœ¨ã®æœˆã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
            const currentMonth = new Date().toISOString().substr(0, 7);
            const isCurrentMonth = monthData.month === currentMonth;
            
            if (monthData.workDays === 0 && !isCurrentMonth) {
                infoContainer.innerHTML = `
                    <div style="color: #ff1493; font-weight: bold; margin-bottom: 10px;">${formattedDate}</div>
                    <div style="color: #999; text-align: center;">ã“ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</div>
                `;
                return;
            }
            
            // ç¾åœ¨ã®æœˆã®å ´åˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚‚è¡¨ç¤º
            let realtimeInfo = '';
            if (isCurrentMonth) {
                const currentTech = parseFloat(document.getElementById('techSales')?.value) || 0;
                const currentProduct = parseFloat(document.getElementById('productSales')?.value) || 0;
                const currentTotal = currentTech + currentProduct;
                
                if (currentTotal > 0) {
                    realtimeInfo = `
                        <div style="margin-top: 15px; padding: 10px; background: rgba(76, 205, 196, 0.1); border-radius: 8px; border-left: 3px solid #4ecdc4;">
                            <div style="font-size: 12px; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">ğŸ“ å…¥åŠ›ä¸­ã®ãƒ‡ãƒ¼ã‚¿</div>
                            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 8px;">
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #4ecdc4;">æŠ€è¡“å£²ä¸Š</div>
                                    <div style="font-weight: bold;">${currentTech.toLocaleString()}å††</div>
                                </div>
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #ffa500;">åº—è²©å£²ä¸Š</div>
                                    <div style="font-weight: bold;">${currentProduct.toLocaleString()}å††</div>
                                </div>
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #ff1493;">ç·å£²ä¸Š</div>
                                    <div style="font-weight: bold; color: #ff1493;">${currentTotal.toLocaleString()}å††</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            infoContainer.innerHTML = `
                <div style="color: #ff1493; font-weight: bold; margin-bottom: 10px;">${formattedDate}ã®å®Ÿç¸¾</div>
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                    <div style="text-align: center; padding: 8px; background: rgba(255, 20, 147, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #ff1493; font-weight: bold;">â–  ç·å£²ä¸Š</div>
                        <div style="font-weight: bold; color: #ff1493; font-size: 14px;">${monthData.totalSales.toLocaleString()}å††</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(76, 205, 196, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #4ecdc4; font-weight: bold;">â–  æŠ€è¡“å£²ä¸Š</div>
                        <div style="font-weight: bold; color: #4ecdc4; font-size: 14px;">${monthData.totalTechSales.toLocaleString()}å††</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255, 165, 0, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #ffa500; font-weight: bold;">â–  åº—è²©å£²ä¸Š</div>
                        <div style="font-weight: bold; color: #ffa500; font-size: 14px;">${monthData.totalProductSales.toLocaleString()}å††</div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #666;">æŒ‡åæ•°</div>
                        <div style="font-weight: bold;">${monthData.nominations}ä»¶</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #666;">ç¨¼åƒæ—¥æ•°</div>
                        <div style="font-weight: bold;">${monthData.workDays}æ—¥</div>
                    </div>
                </div>
                ${realtimeInfo}
            `;
        }
        

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•æ›´æ–°ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ãï¼‰
        let realtimeUpdateTimeout;
        function updateGraphRealtime() {
            try {
                // å‰å›ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
                clearTimeout(realtimeUpdateTimeout);
                
                // 200mså¾Œã«å®Ÿè¡Œï¼ˆé€£ç¶šå…¥åŠ›æ™‚ã®è² è·è»½æ¸›ã€ã‚ˆã‚Šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
                realtimeUpdateTimeout = setTimeout(() => {
                    console.log('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•æ›´æ–°é–‹å§‹');
                    
                    // ç¾åœ¨æœˆæ¬¡ã‚µãƒãƒªãƒ¼ã‚¿ãƒ–ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¦ã€ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿æ›´æ–°
                    const monthlyTab = document.getElementById('monthlyAnalysis');
                    if (monthlyTab && monthlyTab.classList.contains('active')) {
                        // æœˆæ¬¡ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°
                        loadSummaryData();
                        
                        // å°‘ã—é…å»¶ã•ã›ã¦ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                        setTimeout(() => {
                            generateSimpleChart();
                        }, 100);
                    }
                }, 200);
            } catch (error) {
                console.error('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚°ãƒ©ãƒ•ç·šã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
        function updateGraphLines() {
            try {
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å–å¾—
                const totalCheck = document.getElementById('showTotalSales');
                const techCheck = document.getElementById('showTechSales');
                const productCheck = document.getElementById('showProductSales');
                
                // ç·šè¦ç´ ã‚’å–å¾—
                const mainLine = document.getElementById('salesLine');
                const techLine = document.getElementById('techSalesLine');
                const productLine = document.getElementById('productSalesLine');
                
                // ç·å£²ä¸Šç·šï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰ã¯å¸¸ã«è¡¨ç¤º
                if (mainLine) {
                    mainLine.style.display = (totalCheck && totalCheck.checked) ? 'block' : 'block'; // å¸¸ã«è¡¨ç¤º
                }
                
                // æŠ€è¡“å£²ä¸Šç·š
                if (techLine) {
                    techLine.style.display = (techCheck && techCheck.checked) ? 'block' : 'none';
                }
                
                // åº—è²©å£²ä¸Šç·š
                if (productLine) {
                    productLine.style.display = (productCheck && productCheck.checked) ? 'block' : 'none';
                }
                
                console.log('ã‚°ãƒ©ãƒ•ç·šè¡¨ç¤ºæ›´æ–°å®Œäº†');
                
            } catch (error) {
                console.error('ã‚°ãƒ©ãƒ•ç·šè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã‚°ãƒ©ãƒ•ç”Ÿæˆ
        function generateCustomChart() {
            try {
                const startMonth = document.getElementById('chartStartMonth')?.value;
                const endMonth = document.getElementById('chartEndMonth')?.value;
                
                if (!startMonth || !endMonth) {
                    alert('é–‹å§‹æœˆã¨çµ‚äº†æœˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (startMonth > endMonth) {
                    alert('é–‹å§‹æœˆã¯çµ‚äº†æœˆã‚ˆã‚Šå‰ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                console.log('ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã‚°ãƒ©ãƒ•ç”Ÿæˆ:', startMonth, 'ã€œ', endMonth);
                
                const customData = [];
                const startDate = new Date(startMonth + '-01');
                const endDate = new Date(endMonth + '-01');
                
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    const targetMonthStr = currentDate.toISOString().substr(0, 7);
                    const monthData = getMonthData(targetMonthStr);
                    
                    customData.push({
                        month: targetMonthStr,
                        monthName: currentDate.toLocaleDateString('ja-JP', {month: 'short'}),
                        fullDate: new Date(currentDate),
                        totalSales: monthData.totalSales,
                        totalTechSales: monthData.totalTechSales,
                        totalProductSales: monthData.totalProductSales,
                        nominations: monthData.totalNominations,
                        workDays: monthData.workDays
                    });
                    
                    // æ¬¡ã®æœˆã«é€²ã‚€
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
                
                console.log('ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ãƒ‡ãƒ¼ã‚¿:', customData);
                
                if (customData.length === 0) {
                    alert('æŒ‡å®šã—ãŸæœŸé–“ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                    return;
                }
                
                // ã‚°ãƒ©ãƒ•ã‚’æç”»
                drawLineChart(customData);
                
            } catch (error) {
                console.error('ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã‚°ãƒ©ãƒ•ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã‚°ãƒ©ãƒ•ã®ç”Ÿæˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // å˜æœˆãƒ‡ãƒ¼ã‚¿å–å¾—
        function getMonthData(targetMonthStr) {
            const targetDate = new Date(targetMonthStr + '-01');
            const monthName = targetDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'short'
            });
            
            // è©²å½“æœˆã®æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${targetMonthStr}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            // ç¾åœ¨å…¥åŠ›ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ï¼ˆã©ã®æœˆã§ã‚‚ï¼‰
            const currentTech = parseFloat(document.getElementById('techSales')?.value) || 0;
            const currentProduct = parseFloat(document.getElementById('productSales')?.value) || 0;
            const currentDateInput = document.getElementById('reportDate')?.value;
            
            console.log(`getMonthData: ${targetMonthStr}, å…¥åŠ›æ—¥ä»˜: ${currentDateInput}, æŠ€è¡“å£²ä¸Š: ${currentTech}, åº—è²©å£²ä¸Š: ${currentProduct}`);
            
            // å…¥åŠ›ä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã€ãã®æœˆã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹å ´åˆ
            if ((currentTech > 0 || currentProduct > 0) && currentDateInput && currentDateInput.startsWith(targetMonthStr)) {
                console.log(`${targetMonthStr}ã«å…¥åŠ›ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ `);
                const existingReport = reports.find(r => r.date === currentDateInput);
                if (!existingReport) {
                    // ä»®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ 
                    reports.push({
                        date: currentDateInput,
                        techSales: currentTech,
                        productSales: currentProduct,
                        totalSales: currentTech + currentProduct,
                        nominations: parseInt(document.getElementById('nominations')?.value) || 0,
                        isTemporary: true // ä¸€æ™‚çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°
                    });
                    console.log(`ä»®ãƒ‡ãƒ¼ã‚¿è¿½åŠ å®Œäº†: ${currentTech + currentProduct}å††`);
                } else {
                    console.log('æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã£ãŸãŸã‚ã€ä»®ãƒ‡ãƒ¼ã‚¿ã¯è¿½åŠ ã—ãªã„');
                }
            }
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°
            console.log(`${targetMonthStr}: ${reports.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿`, reports);
            
            // æœˆé–“é›†è¨ˆã‚’è¨ˆç®—
            let totalSales = 0;
            let totalTechSales = 0;
            let totalProductSales = 0;
            let totalNominations = 0;
            
            reports.forEach(report => {
                totalSales += report.totalSales || 0;
                totalTechSales += report.techSales || 0;
                totalProductSales += report.productSales || 0;
                totalNominations += report.nominations || 0;
            });
            
            console.log(`${targetMonthStr} é›†è¨ˆ:`, {totalSales, totalTechSales, totalProductSales});
            
            return {
                month: targetMonthStr,
                monthName: monthName,
                totalSales,
                totalTechSales,
                totalProductSales,
                totalNominations,
                workDays: reports.length
            };
        }
        
        // æœŸé–“é¸æŠè¡¨ç¤ºåˆ‡æ›¿æ©Ÿèƒ½
        function toggleChartType() {
            try {
                const customPeriodSelector = document.getElementById('customPeriodSelector');
                
                if (!customPeriodSelector) {
                    console.log('æœŸé–“é¸æŠè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // ç¾åœ¨ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
                if (customPeriodSelector.style.display === 'none' || !customPeriodSelector.style.display) {
                    // æœŸé–“é¸æŠã‚’è¡¨ç¤º
                    customPeriodSelector.style.display = 'block';
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æœŸé–“ã‚’è¨­å®šï¼ˆéå»6ãƒ¶æœˆï¼‰
                    const today = new Date();
                    const endMonth = today.toISOString().substr(0, 7);
                    const startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 5);
                    const startMonth = startDate.toISOString().substr(0, 7);
                    
                    document.getElementById('chartStartMonth').value = startMonth;
                    document.getElementById('chartEndMonth').value = endMonth;
                } else {
                    // æœŸé–“é¸æŠã‚’éè¡¨ç¤º
                    customPeriodSelector.style.display = 'none';
                    
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®12ãƒ¶æœˆè¡¨ç¤ºã«æˆ»ã™
                    generateSimpleChart();
                }
            } catch (error) {
                console.error('è¡¨ç¤ºåˆ‡æ›¿ã‚¨ãƒ©ãƒ¼:', error);
                alert('è¡¨ç¤ºåˆ‡æ›¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // Chart.jsç‰ˆã‚°ãƒ©ãƒ•ä½œæˆ
        function createChartJS() {
            const canvas = document.getElementById('salesTrendChart');
            
            if (!canvas) {
                console.log('Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            console.log('Chart.jsç‰ˆä½œæˆè©¦è¡Œ');
            
            try {
                if (window.salesTrendChart) {
                    window.salesTrendChart.destroy();
                }
                
                window.salesTrendChart = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                        datasets: [{
                            label: 'å£²ä¸Š',
                            data: [100000, 150000, 120000, 180000, 200000, 170000],
                            borderColor: '#ff1493',
                            backgroundColor: 'rgba(255, 20, 147, 0.1)',
                            fill: true
                        }]
                    }
                });
                console.log('Chart.jsä½œæˆæˆåŠŸ');
            } catch (error) {
                console.log('Chart.jsã‚¨ãƒ©ãƒ¼:', error);
                alert('Chart.jsã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚HTMLã‚°ãƒ©ãƒ•ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                toggleChartType();
            }
        }

        // å£²ä¸Šãƒãƒ£ãƒ¼ãƒˆä½œæˆï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        function createSalesChart(canvas, monthlyData, title) {
            console.log('ã‚·ãƒ³ãƒ—ãƒ«ãƒãƒ£ãƒ¼ãƒˆä½œæˆé–‹å§‹:', title);
            console.log('æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿:', monthlyData);
            
            if (!canvas) {
                console.log('ERROR: canvasè¦ç´ ãŒnull');
                return;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«æº–å‚™
            const labels = [];
            const totalSalesData = [];
            
            monthlyData.forEach(data => {
                labels.push(data.monthName || 'æœªè¨­å®š');
                totalSalesData.push(data.totalSales || 0);
            });
            
            console.log('ã‚·ãƒ³ãƒ—ãƒ«ãƒ©ãƒ™ãƒ«:', labels);
            console.log('ã‚·ãƒ³ãƒ—ãƒ«ç·å£²ä¸Šãƒ‡ãƒ¼ã‚¿:', totalSalesData);
            
            // æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªChart.jsè¨­å®š
            try {
                window.salesTrendChart = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ç·å£²ä¸Š',
                            data: totalSalesData,
                            borderColor: '#ff1493',
                            backgroundColor: 'rgba(255, 20, 147, 0.2)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                console.log('Chartä½œæˆæˆåŠŸ');
            } catch (error) {
                console.log('Chartä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            currentUser = null;
            isAdmin = false;
            showScreen('loginScreen');
        }
        // ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒæ©Ÿèƒ½
        
        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportAllData() {
            const allData = {};
            
            // localStorageã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                allData[key] = value;
            }
            
            // JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const dataBlob = new Blob([JSON.stringify(allData, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `salon-data-backup-${new Date().toISOString().substr(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸï¼');
        }

        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    if (confirm('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ãƒ»æ›´æ–°ã•ã‚Œã¾ã™ï¼‰')) {
                        // ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                        Object.keys(data).forEach(key => {
                            localStorage.setItem(key, data[key]);
                        });
                        
                        alert('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸï¼ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
                        location.reload();
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // ========================================
        // Firebaseçµ±åˆã‚³ãƒ¼ãƒ‰
        // ========================================
        
        // Firebaseè¨­å®šï¼ˆFirebase Consoleã‹ã‚‰å–å¾—ã—ãŸè¨­å®šã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", 
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // FirebaseåˆæœŸåŒ–
        let db = null;
        try {
            // Firebaseè¨­å®šãŒæ­£ã—ã„å ´åˆã®ã¿åˆæœŸåŒ–
            if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firebaseæ¥ç¶šæˆåŠŸ');
                showFirebaseStatus('connected');
            } else {
                console.log('Firebaseè¨­å®šå¾…ã¡ - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œ');
                showFirebaseStatus('offline');
            }
        } catch (error) {
            console.log('Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼ - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œ:', error);
            showFirebaseStatus('offline');
        }

        // Firebaseæ¥ç¶šçŠ¶æ…‹è¡¨ç¤º
        function showFirebaseStatus(status) {
            // æ—¢å­˜ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’å‰Šé™¤
            const existingStatus = document.querySelector('.firebase-status');
            if (existingStatus) existingStatus.remove();
            
            const statusDiv = document.createElement('div');
            statusDiv.className = 'firebase-status';
            statusDiv.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 12px;
                font-weight: bold;
                z-index: 1000;
                ${status === 'connected' 
                    ? 'background: #4CAF50; color: white;' 
                    : status === 'syncing' 
                    ? 'background: #FF9800; color: white;'
                    : 'background: #f44336; color: white;'}
            `;
            statusDiv.textContent = status === 'connected' 
                ? 'ğŸ”„ åŒæœŸON' 
                : status === 'syncing'
                ? 'ğŸ“¤ åŒæœŸä¸­...'
                : 'ğŸ“± ãƒ­ãƒ¼ã‚«ãƒ«';
            document.body.appendChild(statusDiv);
        }

        // ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥ç”¨IDç”Ÿæˆ
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // Firestoreã«ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        async function saveToFirestore(collection, data) {
            if (!db) return false;
            
            try {
                showFirebaseStatus('syncing');
                await db.collection(collection).add({
                    ...data,
                    deviceId: getDeviceId(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                showFirebaseStatus('connected');
                return true;
            } catch (error) {
                console.error('Firebaseä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showFirebaseStatus('offline');
                return false;
            }
        }

        // Firestoreã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
        async function getFromFirestore(collection, limit = 100) {
            if (!db) return [];
            
            try {
                const snapshot = await db.collection(collection)
                    .orderBy('timestamp', 'desc')
                    .limit(limit)
                    .get();
                
                const data = [];
                snapshot.forEach(doc => {
                    const docData = doc.data();
                    // timestampã‚’JavaScript Dateã«å¤‰æ›
                    if (docData.timestamp && docData.timestamp.toDate) {
                        docData.timestamp = docData.timestamp.toDate();
                    }
                    data.push({ id: doc.id, ...docData });
                });
                return data;
            } catch (error) {
                console.error('Firebaseå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                return [];
            }
        }

        // æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’Firebaseã«åŒæœŸ
        async function syncDailyReportsToFirebase() {
            if (!db) return;
            
            const reports = JSON.parse(localStorage.getItem('dailyReports') || '{}');
            
            for (const [date, report] of Object.entries(reports)) {
                // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
                try {
                    const existingQuery = await db.collection('daily_reports')
                        .where('date', '==', date)
                        .where('employeeName', '==', report.employeeName)
                        .where('deviceId', '==', getDeviceId())
                        .get();
                    
                    if (existingQuery.empty) {
                        await saveToFirestore('daily_reports', {
                            date: date,
                            employeeName: report.employeeName,
                            sales: report.sales || 0,
                            technicalSales: report.technicalSales || 0,
                            retailSales: report.retailSales || 0,
                            customerCount: report.customerCount || 0,
                            instagramUpdated: report.instagramUpdated || false,
                            tiktokUpdated: report.tiktokUpdated || false,
                            memo: report.memo || ''
                        });
                    }
                } catch (error) {
                    console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                }
            }
        }

        // Firebaseã‹ã‚‰æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«åæ˜ 
        async function syncDailyReportsFromFirebase() {
            if (!db) return;
            
            try {
                const firestoreReports = await getFromFirestore('daily_reports');
                const localReports = JSON.parse(localStorage.getItem('dailyReports') || '{}');
                
                // Firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒãƒ¼ã‚¸
                firestoreReports.forEach(report => {
                    const key = report.date;
                    // ã‚ˆã‚Šæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã®ã¿æ›´æ–°
                    if (!localReports[key] || 
                        (report.timestamp && new Date(report.timestamp) > new Date(localReports[key].lastUpdated || 0))) {
                        localReports[key] = {
                            employeeName: report.employeeName,
                            sales: report.sales || 0,
                            technicalSales: report.technicalSales || 0,
                            retailSales: report.retailSales || 0,
                            customerCount: report.customerCount || 0,
                            instagramUpdated: report.instagramUpdated || false,
                            tiktokUpdated: report.tiktokUpdated || false,
                            memo: report.memo || '',
                            lastUpdated: report.timestamp ? report.timestamp.getTime() : Date.now()
                        };
                    }
                });
                
                localStorage.setItem('dailyReports', JSON.stringify(localReports));
                
                // ç”»é¢æ›´æ–°
                if (typeof loadDailyReport === 'function') {
                    loadDailyReport();
                }
                if (typeof loadMonthlySummary === 'function') {
                    loadMonthlySummary();
                }
            } catch (error) {
                console.error('FirebaseåŒæœŸã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸ
        async function syncGoalsData() {
            if (!db) return;
            
            const goals = JSON.parse(localStorage.getItem('monthlyGoals') || '{}');
            
            for (const [key, goal] of Object.entries(goals)) {
                try {
                    const existingQuery = await db.collection('monthly_goals')
                        .where('monthKey', '==', key)
                        .where('deviceId', '==', getDeviceId())
                        .get();
                    
                    if (existingQuery.empty) {
                        await saveToFirestore('monthly_goals', {
                            monthKey: key,
                            totalSales: goal.totalSales || 0,
                            technicalSales: goal.technicalSales || 0,
                            retailSales: goal.retailSales || 0,
                            customerCount: goal.customerCount || 0,
                            instagramGoal: goal.instagramGoal || 0,
                            tiktokGoal: goal.tiktokGoal || 0
                        });
                    }
                } catch (error) {
                    console.error('ç›®æ¨™åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                }
            }
        }

        // å®Œå…¨åŒæœŸå®Ÿè¡Œ
        async function performFullSync() {
            if (!db || !navigator.onLine || firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                console.log('Firebaseæœªè¨­å®š - åŒæœŸã‚¹ã‚­ãƒƒãƒ—');
                return;
            }
            
            console.log('ğŸ”„ ãƒ•ãƒ«åŒæœŸé–‹å§‹...');
            showFirebaseStatus('syncing');
            
            try {
                // åŒæ–¹å‘åŒæœŸ
                await Promise.all([
                    syncDailyReportsToFirebase(),    // ãƒ­ãƒ¼ã‚«ãƒ« â†’ Firebase
                    syncDailyReportsFromFirebase(),  // Firebase â†’ ãƒ­ãƒ¼ã‚«ãƒ«
                    syncGoalsData()                  // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿åŒæœŸ
                ]);
                
                console.log('âœ… åŒæœŸå®Œäº†');
                showFirebaseStatus('connected');
                
                // åŒæœŸå®Œäº†é€šçŸ¥ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ãˆã‚‹å½¢ã§ï¼‰
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50px;
                    right: 10px;
                    background: #4CAF50;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1001;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = 'âœ… ãƒ‡ãƒ¼ã‚¿åŒæœŸå®Œäº†';
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
                
            } catch (error) {
                console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                showFirebaseStatus('offline');
            }
        }

        // æ—¢å­˜ã®æ—¥å ±ä¿å­˜æ©Ÿèƒ½ã«FirebaseåŒæœŸã‚’è¿½åŠ 
        const originalSaveDailyReport = window.saveDailyReport;
        window.saveDailyReport = async function() {
            // å…ƒã®ä¿å­˜å‡¦ç†ã‚’å®Ÿè¡Œ
            if (originalSaveDailyReport) {
                originalSaveDailyReport.call(this);
            }
            
            // FirebaseåŒæœŸ
            setTimeout(async () => {
                await syncDailyReportsToFirebase();
            }, 100);
        };

        // è‡ªå‹•åŒæœŸï¼ˆ10åˆ†ãŠãï¼‰
        setInterval(async () => {
            if (navigator.onLine && db && firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                await performFullSync();
            }
        }, 10 * 60 * 1000);

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆå›åŒæœŸ
        window.addEventListener('load', async () => {
            // å°‘ã—é…å»¶ã•ã›ã¦DOMæº–å‚™ã‚’å¾…ã¤
            setTimeout(async () => {
                if (navigator.onLine && db && firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                    await performFullSync();
                }
            }, 2000);
        });

        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã®åŒæœŸ
        window.addEventListener('online', async () => {
            console.log('ğŸ“¶ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸° - åŒæœŸé–‹å§‹');
            showFirebaseStatus('syncing');
            if (db) {
                await performFullSync();
            }
        });

        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®è¡¨ç¤ºæ›´æ–°
        window.addEventListener('offline', () => {
            console.log('ğŸ“± ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰');
            showFirebaseStatus('offline');
        });

        // æ‰‹å‹•åŒæœŸãƒœã‚¿ãƒ³æ©Ÿèƒ½ï¼ˆç®¡ç†è€…ç”»é¢ç”¨ï¼‰
        window.manualSync = async function() {
            if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                alert('Firebaseè¨­å®šãŒå¿…è¦ã§ã™ã€‚\n\nè¨­å®šæ–¹æ³•:\n1. Firebase Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š\n2. è¨­å®šã‚³ãƒ¼ãƒ‰ã‚’index.htmlã«è²¼ã‚Šä»˜ã‘\n\nç¾åœ¨ã¯ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã§å‹•ä½œä¸­ã§ã™ã€‚');
                return;
            }
            
            if (!db) {
                alert('Firebaseæ¥ç¶šã«å¤±æ•—ã—ã¦ã„ã¾ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (!navigator.onLine) {
                alert('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦ã§ã™ã€‚');
                return;
            }
            
            await performFullSync();
            alert('ãƒ‡ãƒ¼ã‚¿åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸï¼');
        };

    </script>
    
    <!-- CSSè¿½åŠ : ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .firebase-status {
            transition: all 0.3s ease;
        }
        
        .sync-button {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .sync-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
    </style>
</body>
</html>
