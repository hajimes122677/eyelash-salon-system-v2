<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åæ„Å§ÊØõ„Ç®„ÇØ„Çπ„ÉÜ„Çµ„É≠„É≥ Êó•Â†±„ÉªÁõÆÊ®ôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffeef7 0%, #ffe0f0 50%, #ffcce6 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 420px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .login-form, .main-content {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input[type="text"], input[type="password"], input[type="date"], input[type="number"], textarea, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ffe0f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 240, 250, 0.5);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #ff69b4;
            background: rgba(255, 240, 250, 0.8);
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.2);
        }
        
        .password-container {
            position: relative;
        }
        
        .password-container input {
            padding-right: 50px;
        }
        
        .password-container input[type="password"] {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 67%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #ff69b4;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            z-index: 10;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            touch-action: manipulation;
        }
        
        .btn:hover, .btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 20, 147, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #dda0dd 0%, #ba55d3 100%);
        }
        
        .btn.logout {
            background: linear-gradient(135deg, #ffa500 0%, #ff6347 100%);
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            background: rgba(255, 240, 250, 0.8);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
        }
        
        .tab {
            flex: 1;
            padding: 15px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .daily-entry {
            background: rgba(255, 240, 250, 0.3);
            border: 2px solid #ffe0f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .daily-entry h3 {
            color: #ff1493;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .calculation-display {
            background: linear-gradient(135deg, #e6ffe6 0%, #ccffcc 100%);
            border: 2px solid #90ee90;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .calculation-display h4 {
            color: #006400;
            margin-bottom: 5px;
        }
        
        .calculation-display .amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #006400;
        }
        
        .error {
            background: linear-gradient(135deg, #ffe6e6 0%, #ffcccc 100%);
            border: 2px solid #ff6b6b;
            color: #d32f2f;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .success {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .employee-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255, 240, 250, 0.3);
            border-radius: 15px;
            padding: 20px;
        }
        
        .employee-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ff69b4;
        }
        
        .employee-card h4 {
            color: #ff1493;
            margin-bottom: 10px;
        }
        
        .data-entry {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .new-employee-form {
            background: rgba(255, 240, 250, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .header {
                border-radius: 0;
            }
            
            .row {
                flex-direction: column;
                gap: 0;
            }
            
            .row .form-group {
                margin-bottom: 15px;
            }
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }
        
        .achievement-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .achievement-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff69b4 0%, #ff1493 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .achievement-item {
            background: rgba(255, 240, 250, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ff69b4;
        }
        
        .achievement-title {
            font-weight: bold;
            color: #ff1493;
            margin-bottom: 5px;
        }
        
        .achievement-rate {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíï „Åæ„Å§ÊØõ„Ç®„ÇØ„Çπ„ÉÜ„Çµ„É≠„É≥</h1>
            <p>Êó•Â†±„ÉªÁõÆÊ®ôÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</p>
        </div>
        
        <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
        <div id="loginScreen" class="login-form">
            <div class="form-group">
                <label for="loginName">ÂêçÂâç</label>
                <input type="text" id="loginName" placeholder="„ÅäÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
            </div>
            <div class="form-group">
                <div class="password-container">
                    <label for="loginPassword">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                    <input type="password" id="loginPassword" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
                </div>
            </div>
            <button class="btn" onclick="employeeLogin()">Á§æÂì°„É≠„Ç∞„Ç§„É≥</button>
            <button class="btn secondary" onclick="adminLogin()">ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</button>
            <div class="info-text">
                Êñ∞Ë¶èÁ§æÂì°ÁôªÈå≤„ÅØÁÆ°ÁêÜËÄÖÁîªÈù¢„Åã„ÇâË°å„Åà„Åæ„Åô
            </div>
        </div>
        
        <!-- Á§æÂì°„É°„Ç§„É≥ÁîªÈù¢ -->
        <div id="employeeMain" class="main-content hidden">
            <div class="tabs">
                <button class="tab active" onclick="showTab('dailyReport')">Êó•Â†±</button>
                <button class="tab" onclick="showTab('monthlyGoals')">ÁõÆÊ®ô</button>
                <button class="tab" onclick="showTab('pastData')">Â±•Ê≠¥</button>
                <button class="tab" onclick="showTab('monthlyAnalysis')">ÊúàÈñìÈõÜË®à</button>
            </div>
            
            <!-- Êó•Â†±ÂÖ•Âäõ -->
            <div id="dailyReport" class="tab-content active">
                <div class="daily-entry">
                    <h3>üìù Êó•Â†±ÂÖ•Âäõ</h3>
                    <div class="form-group">
                        <label for="reportDate">Êó•‰ªò</label>
                        <input type="date" id="reportDate" onchange="updateGraphRealtime();">
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="techSales">ÊäÄË°ìÂ£≤‰∏ä (ÂÜÜ)</label>
                            <input type="number" id="techSales" placeholder="0" oninput="calculateTotal(); updateGraphRealtime();">
                        </div>
                        <div class="form-group">
                            <label for="productSales">Â∫óË≤©Â£≤‰∏ä (ÂÜÜ)</label>
                            <input type="number" id="productSales" placeholder="0" oninput="calculateTotal(); updateGraphRealtime();">
                        </div>
                    </div>
                    <div class="calculation-display">
                        <h4>Á∑èÂ£≤‰∏ä</h4>
                        <div class="amount" id="totalSalesDisplay">0 ÂÜÜ</div>
                    </div>
                    <div class="form-group">
                        <label for="nominations">ÊåáÂêçÊï∞</label>
                        <input type="number" id="nominations" placeholder="0" oninput="updateGraphRealtime();">
                    </div>
                    <div class="form-group">
                        <label for="instagramUpdate">InstagramÊäïÁ®øÊõ¥Êñ∞</label>
                        <select id="instagramUpdate">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="ÊäïÁ®øÊ∏à„Åø">ÊäïÁ®øÊ∏à„Åø</option>
                            <option value="Êú™ÊäïÁ®ø">Êú™ÊäïÁ®ø</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tiktokUpdate">Instagram„Çπ„Éà„Éº„É™„ÉºÊõ¥Êñ∞</label>
                        <select id="tiktokUpdate">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="ÊäïÁ®øÊ∏à„Åø">ÊäïÁ®øÊ∏à„Åø</option>
                            <option value="Êú™ÊäïÁ®ø">Êú™ÊäïÁ®ø</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="blogUpdate">„Éñ„É≠„Ç∞Êõ¥Êñ∞</label>
                        <select id="blogUpdate">
                            <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                            <option value="Êõ¥Êñ∞Ê∏à„Åø">Êõ¥Êñ∞Ê∏à„Åø</option>
                            <option value="Êú™Êõ¥Êñ∞">Êú™Êõ¥Êñ∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="insights">Ê∞ó„Å•„Åç„Éª„É°„É¢</label>
                        <textarea id="insights" placeholder="‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„ÇÑÂèçÁúÅÁÇπ„Å™„Å©„ÇíË®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                    </div>
                    <button class="btn" onclick="saveDailyReport()">Êó•Â†±„Çí‰øùÂ≠ò</button>
                </div>
            </div>
            
            <!-- ÊúàÈñìÁõÆÊ®ôË®≠ÂÆö -->
            <div id="monthlyGoals" class="tab-content">
                <div class="daily-entry">
                    <h3>üéØ ÊúàÈñìÁõÆÊ®ôË®≠ÂÆö</h3>
                    <div class="form-group">
                        <label for="goalMonth">ÂØæË±°Êúà</label>
                        <input type="month" id="goalMonth">
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="techSalesGoal">ÊäÄË°ìÂ£≤‰∏äÁõÆÊ®ô (ÂÜÜ)</label>
                            <input type="number" id="techSalesGoal" placeholder="0" oninput="calculateGoalTotal()">
                        </div>
                        <div class="form-group">
                            <label for="productSalesGoal">Â∫óË≤©Â£≤‰∏äÁõÆÊ®ô (ÂÜÜ)</label>
                            <input type="number" id="productSalesGoal" placeholder="0" oninput="calculateGoalTotal()">
                        </div>
                    </div>
                    <div class="calculation-display">
                        <h4>Â£≤‰∏äÁõÆÊ®ôÔºàÂêàË®àÔºâ</h4>
                        <div class="amount" id="totalGoalDisplay">0 ÂÜÜ</div>
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label for="nominationGoal">ÊåáÂêçÊï∞ÁõÆÊ®ô</label>
                            <input type="number" id="nominationGoal" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workDaysGoal">Âá∫Âã§‰∫àÂÆöÊó•Êï∞</label>
                        <input type="number" id="workDaysGoal" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="goalText">ÁõÆÊ®ôÊñáÁ´†</label>
                        <textarea id="goalText" placeholder="‰ªäÊúà„ÅÆÁõÆÊ®ô„ÇÑÊÑèÊ∞óËæº„Åø„ÇíË®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                    </div>
                    <button class="btn" onclick="saveMonthlyGoals()">ÁõÆÊ®ô„Çí‰øùÂ≠ò</button>
                </div>
            </div>
            
            <!-- ÈÅéÂéª„Éá„Éº„ÇøÈñ≤Ë¶ß„Éª‰øÆÊ≠£ -->
            <div id="pastData" class="tab-content">
                <h3>üìã ÈÅéÂéª„ÅÆÊó•Â†±‰∏ÄË¶ß</h3>
                <div class="form-group">
                    <label for="historyMonth">Ë°®Á§∫Êúà</label>
                    <input type="month" id="historyMonth" onchange="loadHistoryData()">
                </div>
                <div id="historyDataDisplay"></div>
            </div>
            
            <!-- ÊúàÈñìÈõÜË®à„Çø„Éñ -->
            <div id="monthlyAnalysis" class="tab-content">
                <h3>üìä ÊúàÈñìÈõÜË®à„ÉªÂàÜÊûê</h3>
                <div class="form-group">
                    <label for="summaryMonth">Ë°®Á§∫Êúà</label>
                    <input type="month" id="summaryMonth" onchange="loadSummaryData(); generateSimpleChart();">
                </div>
                
                <!-- ÊúàÈñìÈõÜË®àË°®Á§∫ -->
                <div id="monthlySummaryDisplay"></div>
                
                <!-- ÈÅéÂéª„Éá„Éº„ÇøÊØîËºÉ„Ç®„É™„Ç¢ -->
                <div id="comparisonArea"></div>
                
                <!-- 12„É∂ÊúàÂ£≤‰∏äÊé®Áßª„Ç∞„É©„Éï„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div id="chartSection" style="background: white; border-radius: 15px; padding: 20px; margin: 20px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h4 style="color: #ff1493; margin-bottom: 15px; text-align: center;">üìà Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï</h4>
                    
                    <!-- ÊúüÈñìÈÅ∏Êäû -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn" style="width: auto; padding: 10px 15px; font-size: 14px;" onclick="generateSimpleChart()">„Ç∞„É©„ÉïË°®Á§∫</button>
                            <button class="btn secondary" style="width: auto; padding: 10px 15px; font-size: 14px;" onclick="toggleChartType()">ÊúüÈñìÈÅ∏Êäû</button>
                        </div>
                        
                        <!-- „Ç´„Çπ„Çø„É†ÊúüÈñìÈÅ∏Êäû -->
                        <div id="customPeriodSelector" style="display: none; margin-top: 15px;">
                            <div style="display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;">
                                <label style="font-size: 0.9em;">ÈñãÂßãÊúà:</label>
                                <input type="month" id="chartStartMonth" style="width: 150px;">
                                <label style="font-size: 0.9em;">ÁµÇ‰∫ÜÊúà:</label>
                                <input type="month" id="chartEndMonth" style="width: 150px;">
                                <button class="btn secondary" style="width: auto; padding: 8px 15px; font-size: 14px;" onclick="generateCustomChart()">Ë°®Á§∫</button>
                            </div>
                        </div>
                        
                        <!-- „Ç∞„É©„ÉïË°®Á§∫Âàá„ÇäÊõø„Åà„Ç≥„É≥„Éà„É≠„Éº„É´ -->
                        <div id="chartControls" style="margin-top: 15px; padding: 10px; background: rgba(255, 20, 147, 0.05); border-radius: 8px;">
                            <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #ff1493; font-size: 14px;">üìä Ë°®Á§∫È†ÖÁõÆÈÅ∏Êäû</div>
                            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showTotalSales" checked onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #ff1493; font-weight: bold;">‚ñ†</span> Á∑èÂ£≤‰∏ä
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showTechSales" onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #4ecdc4; font-weight: bold;">‚ñ†</span> ÊäÄË°ìÂ£≤‰∏ä
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                                    <input type="checkbox" id="showProductSales" onchange="updateGraphLines()" style="margin: 0;">
                                    <span style="color: #ffa500; font-weight: bold;">‚ñ†</span> Â∫óË≤©Â£≤‰∏ä
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- „Ç∞„É©„ÉïË°®Á§∫„Ç®„É™„Ç¢ -->
                    <div id="chartContainer">
                        <!-- Chart.jsÁâàÔºàÈùûË°®Á§∫Ôºâ -->
                        <canvas id="salesTrendChart" style="height: 400px; display: none;"></canvas>
                        
                        <!-- HTML/CSSÁâàÊäò„ÇåÁ∑ö„Ç∞„É©„Éï -->
                        <div id="simpleSalesChart" style="display: block;">
                            <!-- „Ç∞„É©„Éï„Ç≥„É≥„ÉÜ„ÉäÔºàÂõ∫ÂÆöÂπÖ„ÄÅ„Çπ„ÇØ„É≠„Éº„É´„Å™„Åó„ÄÅ12„É∂ÊúàË°®Á§∫Ôºâ -->
                            <div style="padding: 5px; width: 100%; overflow: hidden;">
                                <div id="lineChartContainer" style="position: relative; height: 340px; background: #fafafa; border-radius: 10px; border-bottom: 2px solid #ff1493; width: 100%; max-width: 420px; margin: 0 auto;">
                                    <!-- „Ç∞„É™„ÉÉ„ÉâÁ∑öÔºàËÉåÊôØÔºâ„Å®ÁõÆÊ®ôÁ∑ö -->
                                    <div id="gridLines" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
                                        <!-- ÈÄöÂ∏∏„ÅÆ„Ç∞„É™„ÉÉ„ÉâÁ∑ö -->
                                        <div style="position: absolute; top: 20%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 40%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 60%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <div style="position: absolute; top: 80%; left: 15px; right: 15px; height: 1px; background: #e0e0e0;"></div>
                                        <!-- ÁõÆÊ®ôÁ∑öÔºà50‰∏áÂÜÜ„Éª70‰∏áÂÜÜÔºâ -->
                                        <div id="targetLine500k" style="position: absolute; left: 15px; right: 15px; height: 2px; background: #ff6b6b; opacity: 0.8; display: none;"></div>
                                        <div id="targetLine700k" style="position: absolute; left: 15px; right: 15px; height: 2px; background: #4ecdc4; opacity: 0.8; display: none;"></div>
                                        <!-- ÁõÆÊ®ôÁ∑ö„É©„Éô„É´ -->
                                        <div id="targetLabel500k" style="position: absolute; right: 20px; font-size: 10px; color: #ff6b6b; font-weight: bold; display: none;">50‰∏á</div>
                                        <div id="targetLabel700k" style="position: absolute; right: 20px; font-size: 10px; color: #4ecdc4; font-weight: bold; display: none;">70‰∏á</div>
                                    </div>
                                    
                                    <!-- SVG„ÅßÊäò„ÇåÁ∑ö„Ç∞„É©„Éï -->
                                    <svg id="lineSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                                        <polyline id="salesLine" fill="none" stroke="#ff1493" stroke-width="3" points=""></polyline>
                                        <polyline id="techSalesLine" fill="none" stroke="#4ecdc4" stroke-width="2" points="" style="display: none;"></polyline>
                                        <polyline id="productSalesLine" fill="none" stroke="#ffa500" stroke-width="2" points="" style="display: none;"></polyline>
                                    </svg>
                                    
                                    <!-- „Éá„Éº„Çø„Éù„Ç§„É≥„Éà -->
                                    <div id="dataPoints" style="position: relative; height: 100%;"></div>
                                    
                                    <!-- Êúà„É©„Éô„É´ -->
                                    <div id="monthLabels" style="position: absolute; bottom: 15px; left: 0; right: 0; height: 20px;"></div>
                                </div>
                            </div>
                            
                            <!-- ÈÅ∏Êäû„Åó„ÅüÊúà„ÅÆË©≥Á¥∞Ë°®Á§∫ -->
                            <div id="selectedMonthInfo" style="margin-top: 15px; padding: 15px; background: rgba(255, 20, 147, 0.1); border-radius: 10px; text-align: center; min-height: 50px;">
                                <div style="color: #ff1493; font-weight: bold;">„Ç∞„É©„Éï‰∏ä„ÅÆÁÇπ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë©≥Á¥∞„ÇíÁ¢∫Ë™ç</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- „Éá„Éº„ÇøÁÆ°ÁêÜÊ©üËÉΩ -->
            <div style="margin: 20px 0; padding: 15px; background: rgba(255, 165, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffa500;">
                <div style="font-weight: bold; color: #ffa500; margin-bottom: 10px;">üìÇ „Éá„Éº„ÇøÁÆ°ÁêÜ</div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn secondary" onclick="exportAllData()" style="flex: 1; min-width: 120px;">
                        üíæ „Éá„Éº„Çø‰øùÂ≠ò
                    </button>
                    <label class="btn secondary" style="flex: 1; min-width: 120px; cursor: pointer; text-align: center;">
                        üìÇ „Éá„Éº„ÇøÂæ©ÂÖÉ
                        <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                    </label>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 8px;">
                    üí° ÂÆöÊúüÁöÑ„Å´„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Å¶„ÄÅ„Ç∑„Çπ„ÉÜ„É†Êõ¥Êñ∞ÊôÇ„Å´Âæ©ÂÖÉ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
            </div>

            <button class="sync-button" onclick="manualSync()">üîÑ ÊâãÂãï„Éá„Éº„ÇøÂêåÊúü</button>
            <button class="btn logout" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
        </div>
        
        <!-- ÁÆ°ÁêÜËÄÖ„É°„Ç§„É≥ÁîªÈù¢ -->
        <div id="adminMain" class="main-content hidden">
            <div class="tabs">
                <button class="tab active" onclick="showAdminTab('allEmployees')">ÂÖ®Á§æÂì°„Éá„Éº„Çø</button>
                <button class="tab" onclick="showAdminTab('newEmployee')">Êñ∞Ë¶èÁôªÈå≤</button>
            </div>
            
            <!-- ÂÖ®Á§æÂì°„Éá„Éº„ÇøÈñ≤Ë¶ß -->
            <div id="allEmployees" class="tab-content active">
                <h3>üë• ÂÖ®Á§æÂì°„Éá„Éº„Çø</h3>
                <div class="form-group">
                    <label for="adminDataMonth">Ë°®Á§∫Êúà</label>
                    <input type="month" id="adminDataMonth" onchange="loadAllEmployeeData()">
                </div>
                <div id="allEmployeeDataDisplay" class="employee-list"></div>
            </div>
            
            <!-- Êñ∞Ë¶èÁ§æÂì°ÁôªÈå≤ -->
            <div id="newEmployee" class="tab-content">
                <div class="new-employee-form">
                    <h3>‚ûï Êñ∞Ë¶èÁ§æÂì°ÁôªÈå≤</h3>
                    <div class="form-group">
                        <label for="newEmployeeName">Á§æÂì°Âêç</label>
                        <input type="text" id="newEmployeeName" placeholder="Á§æÂì°Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
                    </div>
                    <div class="form-group">
                        <div class="password-container">
                            <label for="newEmployeePassword">„Éë„Çπ„ÉØ„Éº„Éâ</label>
                            <input type="password" id="newEmployeePassword" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ">
                            <button type="button" class="password-toggle" onclick="togglePassword('newEmployeePassword')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <button class="btn" onclick="registerNewEmployee()">Á§æÂì°„ÇíÁôªÈå≤</button>
                </div>
            </div>
            
            <button class="sync-button" onclick="manualSync()">üîÑ ÊâãÂãï„Éá„Éº„ÇøÂêåÊúü</button>
            <button class="btn logout" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let isAdmin = false;

        // ÂàùÊúüË®≠ÂÆö
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            const currentMonth = todayString.substring(0, 7);
            
            if (document.getElementById('reportDate')) {
                document.getElementById('reportDate').value = todayString;
            }
            if (document.getElementById('goalMonth')) {
                document.getElementById('goalMonth').value = currentMonth;
            }
            if (document.getElementById('historyMonth')) {
                document.getElementById('historyMonth').value = currentMonth;
            }
            if (document.getElementById('summaryMonth')) {
                document.getElementById('summaryMonth').value = currentMonth;
            }
            if (document.getElementById('adminDataMonth')) {
                document.getElementById('adminDataMonth').value = currentMonth;
            }
        });

        // „Éë„Çπ„ÉØ„Éº„ÉâË°®Á§∫Âàá„ÇäÊõø„Åà
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentElement.querySelector('.password-toggle');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        // Á§æÂì°„É≠„Ç∞„Ç§„É≥
        function employeeLogin() {
            const name = document.getElementById('loginName').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!name || !password) {
                alert('ÂêçÂâç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            const employees = getEmployees();
            const employee = employees.find(emp => emp.name === name && emp.password === password);
            
            if (employee) {
                currentUser = name;
                isAdmin = false;
                showScreen('employeeMain');
                loadPastData();
            } else {
                alert('ÂêçÂâç„Åæ„Åü„ÅØ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
            }
        }

        // ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥
        function adminLogin() {
            const password = document.getElementById('loginPassword').value;
            
            if (password === 'admin123') {
                currentUser = 'admin';
                isAdmin = true;
                showScreen('adminMain');
                loadAllEmployeeData();
            } else {
                alert('ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
            }
        }

        // ÁîªÈù¢Âàá„ÇäÊõø„Åà
        function showScreen(screenId) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('employeeMain').classList.add('hidden');
            document.getElementById('adminMain').classList.add('hidden');
            
            document.getElementById(screenId).classList.remove('hidden');
            
            // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Çí„É™„Çª„ÉÉ„Éà
            if (screenId === 'loginScreen') {
                document.getElementById('loginName').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        // „Çø„ÉñÂàá„ÇäÊõø„ÅàÔºàÁ§æÂì°Ôºâ
        function showTab(tabName) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'pastData') {
                loadHistoryData();
            } else if (tabName === 'monthlyAnalysis') {
                loadSummaryData();
                // „Çø„ÉñË°®Á§∫ÂæåÂ∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
                setTimeout(() => {
                    generateSimpleChart();
                }, 200);
            }
        }

        // „Çø„ÉñÂàá„ÇäÊõø„ÅàÔºàÁÆ°ÁêÜËÄÖÔºâ
        function showAdminTab(tabName) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('#adminMain .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('#adminMain .tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'allEmployees') {
                loadAllEmployeeData();
            }
        }

        // Â£≤‰∏äÂêàË®àË®àÁÆó
        function calculateTotal() {
            const techSales = parseFloat(document.getElementById('techSales').value) || 0;
            const productSales = parseFloat(document.getElementById('productSales').value) || 0;
            const total = techSales + productSales;
            
            document.getElementById('totalSalesDisplay').textContent = total.toLocaleString() + ' ÂÜÜ';
        }

        // ÁõÆÊ®ôÂ£≤‰∏äÂêàË®àË®àÁÆó
        function calculateGoalTotal() {
            const techSalesGoal = parseFloat(document.getElementById('techSalesGoal').value) || 0;
            const productSalesGoal = parseFloat(document.getElementById('productSalesGoal').value) || 0;
            const total = techSalesGoal + productSalesGoal;
            
            document.getElementById('totalGoalDisplay').textContent = total.toLocaleString() + ' ÂÜÜ';
        }

        // Á§æÂì°„Éá„Éº„ÇøÂèñÂæó/‰øùÂ≠ò
        function getEmployees() {
            const stored = localStorage.getItem('lashSalonEmployees');
            return stored ? JSON.parse(stored) : [];
        }

        function saveEmployees(employees) {
            localStorage.setItem('lashSalonEmployees', JSON.stringify(employees));
        }

        // Êó•Â†±‰øùÂ≠ò
        function saveDailyReport() {
            const reportData = {
                date: document.getElementById('reportDate').value,
                techSales: parseFloat(document.getElementById('techSales').value) || 0,
                productSales: parseFloat(document.getElementById('productSales').value) || 0,
                totalSales: (parseFloat(document.getElementById('techSales').value) || 0) + (parseFloat(document.getElementById('productSales').value) || 0),
                nominations: parseInt(document.getElementById('nominations').value) || 0,
                instagramUpdate: document.getElementById('instagramUpdate').value,
                tiktokUpdate: document.getElementById('tiktokUpdate').value,
                blogUpdate: document.getElementById('blogUpdate').value,
                insights: document.getElementById('insights').value,
                timestamp: new Date().toISOString()
            };
            
            if (!reportData.date) {
                alert('Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // Â£≤‰∏ä„ÅÆÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            if (reportData.techSales < 0 || reportData.productSales < 0) {
                alert('Â£≤‰∏äÈáëÈ°ç„ÅØ0‰ª•‰∏ä„ÅÆÊï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            const key = `dailyReport_${currentUser}_${reportData.date}`;
            
            // Êó¢Â≠ò„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºà‰øÆÊ≠£„ÅÆÂ†¥ÂêàÔºâ
            const existingData = localStorage.getItem(key);
            if (existingData) {
                const existing = JSON.parse(existingData);
                // ‰øÆÊ≠£Â±•Ê≠¥„ÇíËøΩÂä†
                if (!existing.modificationHistory) {
                    existing.modificationHistory = [];
                }
                reportData.modificationHistory = existing.modificationHistory;
                reportData.modificationHistory.push(`${new Date().toLocaleString('ja-JP')} „Å´‰øÆÊ≠£`);
                reportData.originalTimestamp = existing.timestamp; // ÂÖÉ„ÅÆ‰ΩúÊàêÊó•ÊôÇ„Çí‰øùÊåÅ
            }
            
            localStorage.setItem(key, JSON.stringify(reportData));
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            showMessage('Êó•Â†±„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
            
            // „É™„Ç¢„É´„Çø„Ç§„É†„Åß„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
            updateGraphRealtime();
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('techSales').value = '';
            document.getElementById('productSales').value = '';
            document.getElementById('nominations').value = '';
            document.getElementById('instagramUpdate').value = '';
            document.getElementById('tiktokUpdate').value = '';
            document.getElementById('blogUpdate').value = '';
            document.getElementById('insights').value = '';
            calculateTotal();
        }

        // ÊúàÈñìÁõÆÊ®ô‰øùÂ≠ò
        function saveMonthlyGoals() {
            const techSalesGoal = parseFloat(document.getElementById('techSalesGoal').value) || 0;
            const productSalesGoal = parseFloat(document.getElementById('productSalesGoal').value) || 0;
            
            const goalData = {
                month: document.getElementById('goalMonth').value,
                salesGoal: techSalesGoal + productSalesGoal, // Ëá™ÂãïË®àÁÆó„Åï„Çå„ÅüÂêàË®àÂÄ§
                techSalesGoal: techSalesGoal,
                productSalesGoal: productSalesGoal,
                nominationGoal: parseInt(document.getElementById('nominationGoal').value) || 0,
                workDaysGoal: parseInt(document.getElementById('workDaysGoal').value) || 0,
                goalText: document.getElementById('goalText').value,
                timestamp: new Date().toISOString()
            };
            
            if (!goalData.month) {
                alert('ÂØæË±°Êúà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            const key = `monthlyGoals_${currentUser}_${goalData.month}`;
            localStorage.setItem(key, JSON.stringify(goalData));
            
            showMessage('ÊúàÈñìÁõÆÊ®ô„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
            
            // „É™„Ç¢„É´„Çø„Ç§„É†„Åß„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
            updateGraphRealtime();
        }

        // ÊúàÈñìÈõÜË®à„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        function loadSummaryData() {
            const month = document.getElementById('summaryMonth').value;
            if (!month) return;
            
            const summaryDisplay = document.getElementById('monthlySummaryDisplay');
            summaryDisplay.innerHTML = '';
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${month}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            reports.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // ÊúàÈñìÈõÜË®à„ÅÆË®àÁÆó„Å®Ë°®Á§∫
            if (reports.length > 0) {
                let totalSales = 0;
                let totalTechSales = 0;
                let totalProductSales = 0;
                let totalNominations = 0;
                let instagramCount = 0;
                let tiktokCount = 0;
                let blogCount = 0;
                
                reports.forEach(report => {
                    totalSales += report.totalSales;
                    totalTechSales += report.techSales;
                    totalProductSales += report.productSales;
                    totalNominations += report.nominations;
                    
                    // SNSÊõ¥Êñ∞ÂõûÊï∞„Ç´„Ç¶„É≥„Éà
                    if (report.instagramUpdate === 'ÊäïÁ®øÊ∏à„Åø') instagramCount++;
                    if (report.tiktokUpdate === 'ÊäïÁ®øÊ∏à„Åø') tiktokCount++;
                    if (report.blogUpdate === 'Êõ¥Êñ∞Ê∏à„Åø') blogCount++;
                });
                
                // SNSÊõ¥Êñ∞ÁéáË®àÁÆó
                const instagramRate = reports.length > 0 ? ((instagramCount / reports.length) * 100).toFixed(1) : 0;
                const tiktokRate = reports.length > 0 ? ((tiktokCount / reports.length) * 100).toFixed(1) : 0;
                const blogRate = reports.length > 0 ? ((blogCount / reports.length) * 100).toFixed(1) : 0;
                
                // ÊúàÈñìÁõÆÊ®ô„ÅÆÂèñÂæó„Å®ÈÅîÊàêÁéáÂàÜÊûê
                const goalKey = `monthlyGoals_${currentUser}_${month}`;
                const goalData = localStorage.getItem(goalKey);
                let achievementHTML = '';
                
                if (goalData) {
                    const goals = JSON.parse(goalData);
                    const salesAchievement = goals.salesGoal > 0 ? ((totalSales / goals.salesGoal) * 100) : 0;
                    const techAchievement = goals.techSalesGoal > 0 ? ((totalTechSales / goals.techSalesGoal) * 100) : 0;
                    const productAchievement = goals.productSalesGoal > 0 ? ((totalProductSales / goals.productSalesGoal) * 100) : 0;
                    const nominationAchievement = goals.nominationGoal > 0 ? ((totalNominations / goals.nominationGoal) * 100) : 0;
                    
                    achievementHTML = `
                        <div class="employee-card">
                            <h4>üéØ ÈÅîÊàêÁéáÂàÜÊûê</h4>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">Á∑èÂ£≤‰∏äÈÅîÊàêÁéá</div>
                                <div class="achievement-rate">${salesAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(salesAchievement, 100)}%"></div>
                                </div>
                                <small>${totalSales.toLocaleString()}ÂÜÜ / ${goals.salesGoal.toLocaleString()}ÂÜÜ</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">ÊäÄË°ìÂ£≤‰∏äÈÅîÊàêÁéá</div>
                                <div class="achievement-rate">${techAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(techAchievement, 100)}%"></div>
                                </div>
                                <small>${totalTechSales.toLocaleString()}ÂÜÜ / ${goals.techSalesGoal.toLocaleString()}ÂÜÜ</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">Â∫óË≤©Â£≤‰∏äÈÅîÊàêÁéá</div>
                                <div class="achievement-rate">${productAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(productAchievement, 100)}%"></div>
                                </div>
                                <small>${totalProductSales.toLocaleString()}ÂÜÜ / ${goals.productSalesGoal.toLocaleString()}ÂÜÜ</small>
                            </div>
                            
                            <div class="achievement-item">
                                <div class="achievement-title">ÊåáÂêçÊï∞ÈÅîÊàêÁéá</div>
                                <div class="achievement-rate">${nominationAchievement.toFixed(1)}%</div>
                                <div class="achievement-bar">
                                    <div class="achievement-fill" style="width: ${Math.min(nominationAchievement, 100)}%"></div>
                                </div>
                                <small>${totalNominations}‰ª∂ / ${goals.nominationGoal}‰ª∂</small>
                            </div>
                        </div>
                    `;
                } else {
                    achievementHTML = `
                        <div class="employee-card">
                            <h4>üéØ ÈÅîÊàêÁéáÂàÜÊûê</h4>
                            <div class="info-text">
                                „Åì„ÅÆÊúà„ÅÆÁõÆÊ®ô„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>
                                „ÄåÁõÆÊ®ô„Äç„Çø„Éñ„Åã„ÇâÊúàÈñìÁõÆÊ®ô„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </div>
                        </div>
                    `;
                }
                
                summaryDisplay.innerHTML = `
                    <div class="employee-card">
                        <h4>üìä ÊúàÈñìÂÆüÁ∏æ„Çµ„Éû„É™„Éº</h4>
                        <div class="data-entry"><strong>Á∑èÂ£≤‰∏ä: ${totalSales.toLocaleString()}ÂÜÜ</strong></div>
                        <div class="data-entry">ÊäÄË°ìÂ£≤‰∏ä: ${totalTechSales.toLocaleString()}ÂÜÜ</div>
                        <div class="data-entry">Â∫óË≤©Â£≤‰∏ä: ${totalProductSales.toLocaleString()}ÂÜÜ</div>
                        <div class="data-entry">ÊåáÂêçÊï∞: ${totalNominations}‰ª∂</div>
                        <div class="data-entry">ÂÖ•ÂäõÊó•Êï∞: ${reports.length}Êó•</div>
                    </div>
                    
                    <div class="employee-card">
                        <h4>üì± SNSÊõ¥Êñ∞Áéá</h4>
                        <div class="achievement-item">
                            <div class="achievement-title">InstagramÊäïÁ®øÊõ¥Êñ∞Áéá</div>
                            <div class="achievement-rate">${instagramRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${instagramRate}%"></div>
                            </div>
                            <small>${instagramCount}Âõû / ${reports.length}Êó•</small>
                        </div>
                        
                        <div class="achievement-item">
                            <div class="achievement-title">Instagram„Çπ„Éà„Éº„É™„ÉºÊõ¥Êñ∞Áéá</div>
                            <div class="achievement-rate">${tiktokRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${tiktokRate}%"></div>
                            </div>
                            <small>${tiktokCount}Âõû / ${reports.length}Êó•</small>
                        </div>
                        
                        <div class="achievement-item">
                            <div class="achievement-title">„Éñ„É≠„Ç∞Êõ¥Êñ∞Áéá</div>
                            <div class="achievement-rate">${blogRate}%</div>
                            <div class="achievement-bar">
                                <div class="achievement-fill" style="width: ${blogRate}%"></div>
                            </div>
                            <small>${blogCount}Âõû / ${reports.length}Êó•</small>
                        </div>
                    </div>
                    
                    ${achievementHTML}
                `;
                
                // ÈÅéÂéª„Éá„Éº„Çø„Å®„ÅÆÊØîËºÉ„ÇíÁîüÊàê
                generateComparison(month, totalSales, totalTechSales, totalProductSales, totalNominations, instagramRate, tiktokRate, blogRate);
                
                // ÂàùÊúü„Ç∞„É©„ÉïË°®Á§∫ÔºàÂÆü„Éá„Éº„ÇøÔºâ
                initializeChart(month);
            }
            
            if (reports.length === 0) {
                summaryDisplay.innerHTML = '<div class="info-text">„Åì„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>';
                // „Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„Åß„ÇÇÂàùÊúü„Ç∞„É©„Éï„ÇíË°®Á§∫
                const month = document.getElementById('summaryMonth').value || new Date().toISOString().substr(0, 7);
                initializeChart(month);
                return;
            }
        }


        // Â±•Ê≠¥„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºàÊñ∞„Åó„ÅÑÂ±•Ê≠¥„Çø„ÉñÁî®Ôºâ
        function loadHistoryData() {
            const month = document.getElementById('historyMonth').value;
            if (!month) return;
            
            const display = document.getElementById('historyDataDisplay');
            display.innerHTML = '';
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${month}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            reports.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (reports.length === 0) {
                display.innerHTML = '<div class="info-text">„Åì„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>';
                return;
            }
            
            reports.forEach(report => {
                const reportDiv = document.createElement('div');
                reportDiv.className = 'employee-card';
                
                // ‰øÆÊ≠£Â±•Ê≠¥„ÅÆË°®Á§∫
                let modificationHistory = '';
                if (report.modificationHistory && report.modificationHistory.length > 0) {
                    modificationHistory = `
                        <div class="data-entry" style="color: #888; font-size: 0.8em;">
                            ‰øÆÊ≠£Â±•Ê≠¥: ${report.modificationHistory[report.modificationHistory.length - 1]}
                        </div>
                    `;
                }
                
                reportDiv.innerHTML = `
                    <h4>üìÖ ${new Date(report.date).toLocaleDateString('ja-JP')}</h4>
                    <div class="data-entry">ÊäÄË°ìÂ£≤‰∏ä: ${report.techSales.toLocaleString()}ÂÜÜ</div>
                    <div class="data-entry">Â∫óË≤©Â£≤‰∏ä: ${report.productSales.toLocaleString()}ÂÜÜ</div>
                    <div class="data-entry">Á∑èÂ£≤‰∏ä: ${report.totalSales.toLocaleString()}ÂÜÜ</div>
                    <div class="data-entry">ÊåáÂêçÊï∞: ${report.nominations}‰ª∂</div>
                    <div class="data-entry">Instagram: ${report.instagramUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div class="data-entry">TikTok: ${report.tiktokUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div class="data-entry">„Éñ„É≠„Ç∞: ${report.blogUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div class="data-entry">Ê∞ó„Å•„Åç: ${report.insights || 'Êú™Ë®òÈå≤'}</div>
                    ${modificationHistory}
                    <button class="btn secondary" onclick="editReport('${report.date}')">‰øÆÊ≠£</button>
                `;
                display.appendChild(reportDiv);
            });
        }

        // Â†±ÂëäÊõ∏‰øÆÊ≠£
        function editReport(date) {
            const key = `dailyReport_${currentUser}_${date}`;
            const report = JSON.parse(localStorage.getItem(key));
            
            if (!report) return;
            
            // „Éï„Ç©„Éº„É†„Å´ÂÄ§„ÇíË®≠ÂÆö
            document.getElementById('reportDate').value = report.date;
            document.getElementById('techSales').value = report.techSales;
            document.getElementById('productSales').value = report.productSales;
            document.getElementById('nominations').value = report.nominations;
            document.getElementById('instagramUpdate').value = report.instagramUpdate || '';
            document.getElementById('tiktokUpdate').value = report.tiktokUpdate || '';
            document.getElementById('blogUpdate').value = report.blogUpdate || '';
            document.getElementById('insights').value = report.insights || '';
            
            calculateTotal();
            
            // Êó•Â†±„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('button[onclick="showTab(\'dailyReport\')"]').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('dailyReport').classList.add('active');
            
            showMessage('‰øÆÊ≠£Áî®„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü„ÄÇÁ∑®ÈõÜ„Åó„Å¶‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'success');
        }

        // ÂÖ®Á§æÂì°„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºàÁÆ°ÁêÜËÄÖÁî®Ôºâ
        function loadAllEmployeeData() {
            const month = document.getElementById('adminDataMonth').value;
            if (!month) return;
            
            const display = document.getElementById('allEmployeeDataDisplay');
            display.innerHTML = '';
            
            const employees = getEmployees();
            if (employees.length === 0) {
                display.innerHTML = '<div class="info-text">ÁôªÈå≤„Åï„Çå„ÅüÁ§æÂì°„Åå„ÅÑ„Åæ„Åõ„Çì„ÄÇ</div>';
                return;
            }
            
            employees.forEach(employee => {
                const employeeData = [];
                
                // Ë©≤ÂΩìÊúà„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(`dailyReport_${employee.name}_${month}`)) {
                        const data = JSON.parse(localStorage.getItem(key));
                        employeeData.push(data);
                    }
                }
                
                employeeData.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const employeeDiv = document.createElement('div');
                employeeDiv.className = 'employee-card';
                
                let totalSales = 0;
                let totalTechSales = 0;
                let totalProductSales = 0;
                let totalNominations = 0;
                
                employeeData.forEach(data => {
                    totalSales += data.totalSales;
                    totalTechSales += data.techSales;
                    totalProductSales += data.productSales;
                    totalNominations += data.nominations;
                });
                
                let dataHTML = `<h4>üë§ ${employee.name}</h4>`;
                dataHTML += `<div class="data-entry"><strong>ÊúàÈñìÂêàË®à - Á∑èÂ£≤‰∏ä: ${totalSales.toLocaleString()}ÂÜÜ | ÊäÄË°ìÂ£≤‰∏ä: ${totalTechSales.toLocaleString()}ÂÜÜ | Â∫óË≤©Â£≤‰∏ä: ${totalProductSales.toLocaleString()}ÂÜÜ | ÊåáÂêçÊï∞: ${totalNominations}‰ª∂</strong></div>`;
                
                if (employeeData.length === 0) {
                    dataHTML += '<div class="data-entry">„Åì„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>';
                } else {
                    employeeData.forEach(data => {
                        dataHTML += `
                            <div class="data-entry" style="cursor: pointer; background: rgba(255, 105, 180, 0.1); border-radius: 8px; margin: 5px 0; padding: 10px;" onclick="showReportDetails('${employee.name}', '${data.date}')">
                                üìÖ ${new Date(data.date).toLocaleDateString('ja-JP')} - 
                                Á∑èÂ£≤‰∏ä: ${data.totalSales.toLocaleString()}ÂÜÜ | 
                                ÊåáÂêçÊï∞: ${data.nominations}‰ª∂
                                <small style="display: block; color: #888; margin-top: 5px;">„ÇØ„É™„ÉÉ„ÇØ„ÅßË©≥Á¥∞Ë°®Á§∫</small>
                            </div>
                        `;
                    });
                }
                
                employeeDiv.innerHTML = dataHTML;
                display.appendChild(employeeDiv);
            });
        }

        // Êó•Â†±Ë©≥Á¥∞Ë°®Á§∫ÔºàÁÆ°ÁêÜËÄÖÁî®Ôºâ
        function showReportDetails(employeeName, date) {
            const key = `dailyReport_${employeeName}_${date}`;
            const report = JSON.parse(localStorage.getItem(key));
            
            if (!report) {
                alert('„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                return;
            }
            
            const detailsHTML = `
                <div style="background: white; border-radius: 15px; padding: 20px; margin: 10px 0; border: 2px solid #ff69b4;">
                    <h4 style="color: #ff1493; margin-bottom: 15px;">üìã ${employeeName}„Åï„Çì„ÅÆÊó•Â†±Ë©≥Á¥∞ - ${new Date(report.date).toLocaleDateString('ja-JP')}</h4>
                    <div style="margin-bottom: 10px;"><strong>ÊäÄË°ìÂ£≤‰∏ä:</strong> ${report.techSales.toLocaleString()}ÂÜÜ</div>
                    <div style="margin-bottom: 10px;"><strong>Â∫óË≤©Â£≤‰∏ä:</strong> ${report.productSales.toLocaleString()}ÂÜÜ</div>
                    <div style="margin-bottom: 10px;"><strong>Á∑èÂ£≤‰∏ä:</strong> ${report.totalSales.toLocaleString()}ÂÜÜ</div>
                    <div style="margin-bottom: 10px;"><strong>ÊåáÂêçÊï∞:</strong> ${report.nominations}‰ª∂</div>
                    <div style="margin-bottom: 10px;"><strong>Instagram:</strong> ${report.instagramUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div style="margin-bottom: 10px;"><strong>TikTok:</strong> ${report.tiktokUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div style="margin-bottom: 10px;"><strong>„Éñ„É≠„Ç∞:</strong> ${report.blogUpdate || 'Êú™Ë®òÈå≤'}</div>
                    <div style="margin-bottom: 15px;"><strong>Ê∞ó„Å•„Åç„Éª„É°„É¢:</strong><br>${report.insights || 'Êú™Ë®òÈå≤'}</div>
                    <div style="font-size: 0.8em; color: #888;">Ë®òÈå≤Êó•ÊôÇ: ${new Date(report.timestamp).toLocaleString('ja-JP')}</div>
                    <button onclick="closeReportDetails()" style="margin-top: 15px; padding: 10px 20px; background: #ff69b4; color: white; border: none; border-radius: 8px; cursor: pointer;">Èñâ„Åò„Çã</button>
                </div>
            `;
            
            // Êó¢Â≠ò„ÅÆË©≥Á¥∞Ë°®Á§∫„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existingDetail = document.getElementById('reportDetail');
            if (existingDetail) {
                existingDetail.remove();
            }
            
            // Ë©≥Á¥∞Ë°®Á§∫„ÇíÊåøÂÖ•
            const detailDiv = document.createElement('div');
            detailDiv.id = 'reportDetail';
            detailDiv.innerHTML = detailsHTML;
            
            const adminDisplay = document.getElementById('allEmployeeDataDisplay');
            adminDisplay.insertBefore(detailDiv, adminDisplay.firstChild);
            
            // Ë©≥Á¥∞Ë°®Á§∫„Å´„Çπ„ÇØ„É≠„Éº„É´
            detailDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Êó•Â†±Ë©≥Á¥∞„ÇíÈñâ„Åò„Çã
        function closeReportDetails() {
            const detail = document.getElementById('reportDetail');
            if (detail) {
                detail.remove();
            }
        }

        // Êñ∞Ë¶èÁ§æÂì°ÁôªÈå≤
        function registerNewEmployee() {
            const name = document.getElementById('newEmployeeName').value.trim();
            const password = document.getElementById('newEmployeePassword').value;
            
            if (!name || !password) {
                alert('Á§æÂì°Âêç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            const employees = getEmployees();
            
            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            if (employees.find(emp => emp.name === name)) {
                alert('„Åì„ÅÆÁ§æÂì°Âêç„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                return;
            }
            
            // Êñ∞Ë¶èÁ§æÂì°ËøΩÂä†
            employees.push({
                name: name,
                password: password,
                createdAt: new Date().toISOString()
            });
            
            saveEmployees(employees);
            
            showMessage('Êñ∞Ë¶èÁ§æÂì°„ÇíÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('newEmployeeName').value = '';
            document.getElementById('newEmployeePassword').value = '';
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            // „É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ©Âàá„Å™Â†¥ÊâÄ„Å´ÊåøÂÖ•
            const activeContent = document.querySelector('.tab-content.active') || document.querySelector('.main-content:not(.hidden)');
            if (activeContent) {
                activeContent.insertBefore(messageDiv, activeContent.firstChild);
                
                // 3ÁßíÂæå„Å´Ëá™ÂãïÂâäÈô§
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 3000);
            }
        }

        // ÈÅéÂéª„Éá„Éº„Çø„Å®„ÅÆÊØîËºÉÊ©üËÉΩ
        function generateComparison(currentMonth, totalSales, totalTechSales, totalProductSales, totalNominations, instagramRate, tiktokRate, blogRate) {
            const comparisonDisplay = document.getElementById('comparisonArea');
            
            // ÂâçÊúà„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
            const lastMonthData = getLastMonthData(currentMonth);
            
            // ÈÅéÂéª1Âπ¥Èñì„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
            const yearlyData = getYearlyData(currentMonth);
            
            let comparisonHTML = '';
            
            // ÂâçÊúà„Å®„ÅÆÊØîËºÉ
            if (lastMonthData) {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>üìä ÂâçÊúà„Å®„ÅÆÊØîËºÉ</h4>
                        ${generateMonthComparison(lastMonthData, {
                            totalSales, totalTechSales, totalProductSales, totalNominations,
                            instagramRate, tiktokRate, blogRate
                        })}
                    </div>
                `;
            } else {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>üìä ÂâçÊúà„Å®„ÅÆÊØîËºÉ</h4>
                        <div class="info-text">
                            ÂâçÊúà„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ<br>
                            2„É∂ÊúàÁõÆ‰ª•Èôç„Åã„ÇâÊØîËºÉ„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ
                        </div>
                    </div>
                `;
            }
            
            // ÈÅéÂéª1Âπ¥Èñì„Å®„ÅÆÊØîËºÉ
            if (yearlyData.length > 0) {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>üìà ÈÅéÂéª1Âπ¥Èñì„Å®„ÅÆÊØîËºÉ</h4>
                        ${generateYearlyComparison(yearlyData, {
                            totalSales, totalTechSales, totalProductSales, totalNominations,
                            instagramRate, tiktokRate, blogRate
                        })}
                    </div>
                `;
            } else {
                comparisonHTML += `
                    <div class="employee-card">
                        <h4>üìà ÈÅéÂéª1Âπ¥Èñì„Å®„ÅÆÊØîËºÉ</h4>
                        <div class="info-text">
                            ÈÅéÂéª1Âπ¥Èñì„ÅÆ„Éá„Éº„Çø„Åå„Åæ„Å†ËìÑÁ©ç„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>
                            „Éá„Éº„Çø„ÅåÂ¢ó„Åà„Çã„Å®Ë©≥Á¥∞„Å™Âπ¥ÈñìÊØîËºÉ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ
                        </div>
                    </div>
                `;
            }
            
            comparisonDisplay.innerHTML = comparisonHTML;
        }
        
        // ÂâçÊúà„Éá„Éº„ÇøÂèñÂæó
        function getLastMonthData(currentMonth) {
            const currentDate = new Date(currentMonth + '-01');
            const lastMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            const lastMonthStr = lastMonth.toISOString().substr(0, 7);
            
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${lastMonthStr}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            if (reports.length === 0) return null;
            
            let totalSales = 0, totalTechSales = 0, totalProductSales = 0, totalNominations = 0;
            let instagramCount = 0, tiktokCount = 0, blogCount = 0;
            
            reports.forEach(report => {
                totalSales += report.totalSales;
                totalTechSales += report.techSales;
                totalProductSales += report.productSales;
                totalNominations += report.nominations;
                
                if (report.instagramUpdate === 'ÊäïÁ®øÊ∏à„Åø') instagramCount++;
                if (report.tiktokUpdate === 'ÊäïÁ®øÊ∏à„Åø') tiktokCount++;
                if (report.blogUpdate === 'Êõ¥Êñ∞Ê∏à„Åø') blogCount++;
            });
            
            return {
                month: lastMonthStr,
                totalSales, totalTechSales, totalProductSales, totalNominations,
                instagramRate: ((instagramCount / reports.length) * 100).toFixed(1),
                tiktokRate: ((tiktokCount / reports.length) * 100).toFixed(1),
                blogRate: ((blogCount / reports.length) * 100).toFixed(1),
                workDays: reports.length
            };
        }
        
        // ÈÅéÂéª1Âπ¥Èñì„Éá„Éº„ÇøÂèñÂæó
        function getYearlyData(currentMonth) {
            const currentDate = new Date(currentMonth + '-01');
            const yearlyData = [];
            
            for (let i = 1; i <= 12; i++) {
                const targetDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const targetMonthStr = targetDate.toISOString().substr(0, 7);
                
                const reports = [];
                for (let j = 0; j < localStorage.length; j++) {
                    const key = localStorage.key(j);
                    if (key.startsWith(`dailyReport_${currentUser}_${targetMonthStr}`)) {
                        const data = JSON.parse(localStorage.getItem(key));
                        reports.push(data);
                    }
                }
                
                if (reports.length > 0) {
                    let totalSales = 0, totalTechSales = 0, totalProductSales = 0, totalNominations = 0;
                    
                    reports.forEach(report => {
                        totalSales += report.totalSales;
                        totalTechSales += report.techSales;
                        totalProductSales += report.productSales;
                        totalNominations += report.nominations;
                    });
                    
                    yearlyData.push({
                        month: targetMonthStr,
                        totalSales, totalTechSales, totalProductSales, totalNominations,
                        workDays: reports.length
                    });
                }
            }
            
            return yearlyData.reverse();
        }
        
        // ÂâçÊúàÊØîËºÉ„Éá„Éº„ÇøÁîüÊàê
        function generateMonthComparison(lastMonth, current) {
            const salesChange = current.totalSales - lastMonth.totalSales;
            const salesChangePercent = lastMonth.totalSales > 0 ? ((salesChange / lastMonth.totalSales) * 100).toFixed(1) : 0;
            
            const techChange = current.totalTechSales - lastMonth.totalTechSales;
            const techChangePercent = lastMonth.totalTechSales > 0 ? ((techChange / lastMonth.totalTechSales) * 100).toFixed(1) : 0;
            
            const productChange = current.totalProductSales - lastMonth.totalProductSales;
            const productChangePercent = lastMonth.totalProductSales > 0 ? ((productChange / lastMonth.totalProductSales) * 100).toFixed(1) : 0;
            
            const nominationChange = current.totalNominations - lastMonth.totalNominations;
            
            const getChangeColor = (value) => value >= 0 ? '#28a745' : '#dc3545';
            const getChangeIcon = (value) => value >= 0 ? 'üìà' : 'üìâ';
            
            return `
                <div class="data-entry">
                    <strong>ÂâçÊúà: ${new Date(lastMonth.month + '-01').toLocaleDateString('ja-JP', {year: 'numeric', month: 'long'})}</strong>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(salesChange)};">
                    ${getChangeIcon(salesChange)} Á∑èÂ£≤‰∏ä: ${salesChange >= 0 ? '+' : ''}${salesChange.toLocaleString()}ÂÜÜ (${salesChangePercent >= 0 ? '+' : ''}${salesChangePercent}%)
                    <br><small>ÂâçÊúà: ${lastMonth.totalSales.toLocaleString()}ÂÜÜ ‚Üí ‰ªäÊúà: ${current.totalSales.toLocaleString()}ÂÜÜ</small>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(techChange)};">
                    ${getChangeIcon(techChange)} ÊäÄË°ìÂ£≤‰∏ä: ${techChange >= 0 ? '+' : ''}${techChange.toLocaleString()}ÂÜÜ (${techChangePercent >= 0 ? '+' : ''}${techChangePercent}%)
                </div>
                <div class="data-entry" style="color: ${getChangeColor(productChange)};">
                    ${getChangeIcon(productChange)} Â∫óË≤©Â£≤‰∏ä: ${productChange >= 0 ? '+' : ''}${productChange.toLocaleString()}ÂÜÜ (${productChangePercent >= 0 ? '+' : ''}${productChangePercent}%)
                </div>
                <div class="data-entry" style="color: ${getChangeColor(nominationChange)};">
                    ${getChangeIcon(nominationChange)} ÊåáÂêçÊï∞: ${nominationChange >= 0 ? '+' : ''}${nominationChange}‰ª∂
                </div>
            `;
        }
        
        // Âπ¥ÈñìÊØîËºÉ„Éá„Éº„ÇøÁîüÊàê
        function generateYearlyComparison(yearlyData, current) {
            const avgSales = yearlyData.reduce((sum, data) => sum + data.totalSales, 0) / yearlyData.length;
            const avgTechSales = yearlyData.reduce((sum, data) => sum + data.totalTechSales, 0) / yearlyData.length;
            const avgProductSales = yearlyData.reduce((sum, data) => sum + data.totalProductSales, 0) / yearlyData.length;
            const avgNominations = yearlyData.reduce((sum, data) => sum + data.totalNominations, 0) / yearlyData.length;
            
            const maxSales = Math.max(...yearlyData.map(data => data.totalSales));
            const minSales = Math.min(...yearlyData.map(data => data.totalSales));
            
            const salesVsAvg = current.totalSales - avgSales;
            const salesVsAvgPercent = avgSales > 0 ? ((salesVsAvg / avgSales) * 100).toFixed(1) : 0;
            
            const getChangeColor = (value) => value >= 0 ? '#28a745' : '#dc3545';
            const getChangeIcon = (value) => value >= 0 ? 'üìà' : 'üìâ';
            
            return `
                <div class="data-entry">
                    <strong>ÈÅéÂéª${yearlyData.length}„É∂Êúà„ÅÆÂπ≥Âùá„Å®„ÅÆÊØîËºÉ</strong>
                </div>
                <div class="data-entry" style="color: ${getChangeColor(salesVsAvg)};">
                    ${getChangeIcon(salesVsAvg)} Á∑èÂ£≤‰∏ä: Âπ≥Âùá„Çà„Çä${salesVsAvg >= 0 ? '+' : ''}${salesVsAvg.toLocaleString()}ÂÜÜ (${salesVsAvgPercent >= 0 ? '+' : ''}${salesVsAvgPercent}%)
                    <br><small>ÈÅéÂéªÂπ≥Âùá: ${avgSales.toLocaleString()}ÂÜÜ</small>
                </div>
                <div class="data-entry">
                    üìä ÈÅéÂéªÊúÄÈ´ò: ${maxSales.toLocaleString()}ÂÜÜ | ÊúÄ‰Ωé: ${minSales.toLocaleString()}ÂÜÜ
                </div>
                <div class="data-entry">
                    üìà ÊäÄË°ìÂ£≤‰∏äÂπ≥Âùá: ${avgTechSales.toLocaleString()}ÂÜÜ | Â∫óË≤©Â£≤‰∏äÂπ≥Âùá: ${avgProductSales.toLocaleString()}ÂÜÜ
                </div>
                <div class="data-entry">
                    üéØ ÊåáÂêçÊï∞Âπ≥Âùá: ${avgNominations.toFixed(1)}‰ª∂
                </div>
            `;
        }

        // „Ç∞„É©„ÉïÂàùÊúüÂåñÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        function initializeChart(currentMonth) {
            console.log('„Ç∑„É≥„Éó„É´„Ç∞„É©„ÉïÂàùÊúüÂåñÈñãÂßã:', currentMonth);
            
            // HTML„ÉÅ„É£„Éº„Éà„ÇíÁõ¥Êé•Êõ¥Êñ∞
            setTimeout(() => {
                generateSimpleChart();
            }, 100);
        }
        
        // Êäò„ÇåÁ∑ö„Ç∞„É©„ÉïÁîüÊàêÔºàÈÅéÂéª1Âπ¥ÂàÜÔºâ
        function generateSimpleChart() {
            console.log('Êäò„ÇåÁ∑ö„Ç∞„É©„ÉïÁîüÊàêÈñãÂßã');
            
            // ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (!currentUser) {
                console.log('„É¶„Éº„Ç∂„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            // ÊúàÊ¨°„Çµ„Éû„É™„Éº„ÅßÈÅ∏Êäû‰∏≠„ÅÆÊúà„ÇíÂèñÂæó
            const selectedMonth = document.getElementById('summaryMonth')?.value || new Date().toISOString().substr(0, 7);
            console.log('ÈÅ∏Êäû‰∏≠„ÅÆÊúà:', selectedMonth);
            
            // ÈÅéÂéª1Âπ¥ÂàÜ„ÅÆÂÆüÈöõ„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàÈÅ∏ÊäûÊúà„Åã„ÇâÈÅ°„ÇãÔºâ
            const yearlyData = [];
            
            if (selectedMonth && currentUser) {
                const currentDate = new Date(selectedMonth + '-01');
                
                // ÈÅéÂéª12„É∂ÊúàÂàÜ„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàÈÅ∏ÊäûÊúàÂê´„ÇÄÔºâ
                for (let i = 11; i >= 0; i--) {
                    // Ê≠£Á¢∫„Å™ÊúàË®àÁÆó„ÇíË°å„ÅÜ
                    const targetDate = new Date(currentDate);
                    targetDate.setMonth(currentDate.getMonth() - i);
                    const targetMonthStr = targetDate.toISOString().substr(0, 7);
                    const monthData = getMonthData(targetMonthStr);
                    
                    console.log(`Êúà„Éá„Éº„ÇøÁîüÊàê: i=${i}, „Çø„Éº„Ç≤„ÉÉ„ÉàÊúà=${targetMonthStr}`);
                    
                    // ÂÖ®„Å¶„ÅÆÊúà„ÇíË°®Á§∫Ôºà„Éá„Éº„Çø„Åå„Å™„ÅÑÊúà„ÅØ0„Å®„Åó„Å¶Ë°®Á§∫Ôºâ
                    yearlyData.push({
                        month: targetMonthStr,
                        monthName: targetDate.toLocaleDateString('ja-JP', {month: 'short'}),
                        fullDate: new Date(targetDate),
                        totalSales: monthData.totalSales,
                        totalTechSales: monthData.totalTechSales,
                        totalProductSales: monthData.totalProductSales,
                        nominations: monthData.totalNominations,
                        workDays: monthData.workDays
                    });
                }
            }
            
            console.log('ÂèñÂæó„Åó„ÅüÂπ¥Èñì„Éá„Éº„Çø:', yearlyData);
            
            if (yearlyData.length === 0) {
                const infoContainer = document.getElementById('selectedMonthInfo');
                if (infoContainer) {
                    infoContainer.innerHTML = 
                        '<div style="color: #ff1493; font-weight: bold;">Ë°®Á§∫„Åß„Åç„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                }
                return;
            }
            
            // „Ç∞„É©„ÉïË¶ÅÁ¥†„ÅÆÂ≠òÂú®Á¢∫Ë™ç
            const container = document.getElementById('lineChartContainer');
            const svg = document.getElementById('lineSvg');
            const line = document.getElementById('salesLine');
            
            if (!container || !svg || !line) {
                console.error('„Ç∞„É©„ÉïË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {container: !!container, svg: !!svg, line: !!line});
                setTimeout(() => generateSimpleChart(), 100); // 100msÂæå„Å´ÂÜçË©¶Ë°å
                return;
            }
            
            // Êäò„ÇåÁ∑ö„Ç∞„É©„Éï„ÇíÊèèÁîª
            drawLineChart(yearlyData);
        }
        
        // Êäò„ÇåÁ∑ö„Ç∞„É©„ÉïÊèèÁîªÔºàÂÆâÂÆöÁâàÔºâ
        function drawLineChart(data) {
            const container = document.getElementById('lineChartContainer');
            const svg = document.getElementById('lineSvg');
            const line = document.getElementById('salesLine');
            const dataPointsContainer = document.getElementById('dataPoints');
            const monthLabelsContainer = document.getElementById('monthLabels');
            
            if (!container || !svg || !line || !dataPointsContainer || !monthLabelsContainer) {
                console.error('„Ç∞„É©„ÉïË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Êó¢Â≠ò„ÅÆË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
            dataPointsContainer.innerHTML = '';
            monthLabelsContainer.innerHTML = '';
            
            if (data.length === 0) {
                console.log('„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô');
                return;
            }
            
            console.log('„Ç∞„É©„ÉïÊèèÁîªÈñãÂßã„ÄÅ„Éá„Éº„ÇøÊï∞:', data.length);
            
            // „Ç∞„É©„ÉïË®≠ÂÆöÔºà12„É∂Êúà„Åô„Åπ„Å¶„ÅåË¶ã„Åà„Çã„Çà„ÅÜ„Å´Ë™øÊï¥Ôºâ
            const padding = 25;
            const containerRect = container.getBoundingClientRect();
            const chartWidth = containerRect.width || 400;
            const chartHeight = 280;
            
            // ÊúÄÂ§ßÂÄ§„ÉªÊúÄÂ∞èÂÄ§„ÇíË®àÁÆóÔºàÁõÆÊ®ôÁ∑ö„ÇÇÂê´„ÇÅ„Å¶ÁØÑÂõ≤Ë®≠ÂÆöÔºâ
            const allValues = data.map(d => d.totalSales);
            const maxSales = Math.max(...allValues, 700000); // 70‰∏áÂÜÜ„ÇíÊúÄ‰Ωé„Åß„ÇÇÂê´„ÇÄ
            const minSales = Math.min(...allValues, 0);
            const salesRange = maxSales - minSales || 1;
            
            console.log(`Â£≤‰∏äÁØÑÂõ≤: ${minSales.toLocaleString()} - ${maxSales.toLocaleString()}`);
            
            // ÁõÆÊ®ôÁ∑ö„ÅÆ‰ΩçÁΩÆ„ÇíË®àÁÆó„Åó„Å¶Ë°®Á§∫
            const target500k = 500000;
            const target700k = 700000;
            
            if (target500k >= minSales && target500k <= maxSales) {
                const y500k = padding + ((maxSales - target500k) / salesRange) * (chartHeight - padding * 2);
                const targetLine500k = document.getElementById('targetLine500k');
                const targetLabel500k = document.getElementById('targetLabel500k');
                if (targetLine500k && targetLabel500k) {
                    targetLine500k.style.top = y500k + 'px';
                    targetLine500k.style.display = 'block';
                    targetLabel500k.style.top = (y500k - 15) + 'px';
                    targetLabel500k.style.display = 'block';
                }
            }
            
            if (target700k >= minSales && target700k <= maxSales) {
                const y700k = padding + ((maxSales - target700k) / salesRange) * (chartHeight - padding * 2);
                const targetLine700k = document.getElementById('targetLine700k');
                const targetLabel700k = document.getElementById('targetLabel700k');
                if (targetLine700k && targetLabel700k) {
                    targetLine700k.style.top = y700k + 'px';
                    targetLine700k.style.display = 'block';
                    targetLabel700k.style.top = (y700k - 15) + 'px';
                    targetLabel700k.style.display = 'block';
                }
            }
            
            // „Éá„Éº„Çø„Éù„Ç§„É≥„Éà„Å®Á∑ö„ÅÆÂ∫ßÊ®ô„ÇíË®àÁÆóÔºà12„É∂Êúà„ÅåË¶ãÂàá„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
            const points = [];
            const availableWidth = chartWidth - (padding * 2);
            const monthWidth = data.length > 1 ? availableWidth / (data.length - 1) : 0;
            
            data.forEach((item, index) => {
                const x = padding + (index * monthWidth);
                const y = padding + ((maxSales - item.totalSales) / salesRange) * (chartHeight - padding * 2);
                
                points.push(`${x},${y}`);
                
                // „Éá„Éº„Çø„Éù„Ç§„É≥„Éà‰ΩúÊàêÔºà„Éá„Éº„Çø„Åå„Å™„ÅÑÊúà„ÅØËñÑ„ÅÑ„Ç∞„É¨„ÉºË°®Á§∫Ôºâ
                const hasData = item.workDays > 0;
                const point = document.createElement('div');
                point.style.cssText = `
                    position: absolute;
                    left: ${x - 6}px;
                    top: ${y - 6}px;
                    width: 12px;
                    height: 12px;
                    background: ${hasData ? '#ff1493' : '#ddd'};
                    border: 3px solid white;
                    border-radius: 50%;
                    cursor: pointer;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    opacity: ${hasData ? '1' : '0.6'};
                    z-index: 10;
                `;
                
                point.onclick = () => showMonthDetails(item);
                dataPointsContainer.appendChild(point);
                
                // Êúà„É©„Éô„É´‰ΩúÊàêÔºàË¶ãÂàá„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´ÈÖçÁΩÆÔºâ
                const labelWidth = Math.min(25, monthWidth * 0.8);
                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    left: ${x - labelWidth/2}px;
                    width: ${labelWidth}px;
                    text-align: center;
                    font-size: 10px;
                    color: #666;
                    font-weight: 500;
                `;
                label.textContent = item.monthName;
                monthLabelsContainer.appendChild(label);
            });
            
            // Ë§áÊï∞„ÅÆÁ∑ö„ÅÆÂ∫ßÊ®ô„ÇíË®àÁÆó
            const techPoints = [];
            const productPoints = [];
            
            data.forEach((item, index) => {
                const x = padding + (index * monthWidth);
                const techY = padding + ((maxSales - item.totalTechSales) / salesRange) * (chartHeight - padding * 2);
                const productY = padding + ((maxSales - item.totalProductSales) / salesRange) * (chartHeight - padding * 2);
                
                techPoints.push(`${x},${techY}`);
                productPoints.push(`${x},${productY}`);
            });
            
            // ÂÖ®„Å¶„ÅÆÁ∑ö„ÇíÊõ¥Êñ∞
            if (points.length > 0) {
                // Á∑èÂ£≤‰∏äÁ∑öÔºà„É°„Ç§„É≥Ôºâ
                line.setAttribute('points', points.join(' '));
                
                // ÊäÄË°ìÂ£≤‰∏äÁ∑ö
                const techLine = document.getElementById('techSalesLine');
                if (techLine && techPoints.length > 0) {
                    techLine.setAttribute('points', techPoints.join(' '));
                }
                
                // Â∫óË≤©Â£≤‰∏äÁ∑ö
                const productLine = document.getElementById('productSalesLine');
                if (productLine && productPoints.length > 0) {
                    productLine.setAttribute('points', productPoints.join(' '));
                }
                
                console.log('Ë§áÊï∞SVGÁ∑ö„ÇíÊõ¥Êñ∞:', points.length + '„Éù„Ç§„É≥„Éà');
            }
            
            // Ë°®Á§∫Ë®≠ÂÆö„ÇíÈÅ©Áî®
            updateGraphLines();
            
            console.log('Ë§áÊï∞Êäò„ÇåÁ∑ö„Ç∞„É©„ÉïÊèèÁîªÂÆå‰∫Ü');
        }
        
        // ÊúàË©≥Á¥∞Ë°®Á§∫
        function showMonthDetails(monthData) {
            console.log('ÊúàË©≥Á¥∞Ë°®Á§∫:', monthData);
            const infoContainer = document.getElementById('selectedMonthInfo');
            const date = new Date(monthData.month + '-01');
            const formattedDate = date.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long'});
            
            // ÁèæÂú®„ÅÆÊúà„Åã„Å©„ÅÜ„Åã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const currentMonth = new Date().toISOString().substr(0, 7);
            const isCurrentMonth = monthData.month === currentMonth;
            
            if (monthData.workDays === 0 && !isCurrentMonth) {
                infoContainer.innerHTML = `
                    <div style="color: #ff1493; font-weight: bold; margin-bottom: 10px;">${formattedDate}</div>
                    <div style="color: #999; text-align: center;">„Åì„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                `;
                return;
            }
            
            // ÁèæÂú®„ÅÆÊúà„ÅÆÂ†¥Âêà„ÄÅ„É™„Ç¢„É´„Çø„Ç§„É†„Éá„Éº„Çø„ÇÇË°®Á§∫
            let realtimeInfo = '';
            if (isCurrentMonth) {
                const currentTech = parseFloat(document.getElementById('techSales')?.value) || 0;
                const currentProduct = parseFloat(document.getElementById('productSales')?.value) || 0;
                const currentTotal = currentTech + currentProduct;
                
                if (currentTotal > 0) {
                    realtimeInfo = `
                        <div style="margin-top: 15px; padding: 10px; background: rgba(76, 205, 196, 0.1); border-radius: 8px; border-left: 3px solid #4ecdc4;">
                            <div style="font-size: 12px; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">üìù ÂÖ•Âäõ‰∏≠„ÅÆ„Éá„Éº„Çø</div>
                            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 8px;">
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #4ecdc4;">ÊäÄË°ìÂ£≤‰∏ä</div>
                                    <div style="font-weight: bold;">${currentTech.toLocaleString()}ÂÜÜ</div>
                                </div>
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #ffa500;">Â∫óË≤©Â£≤‰∏ä</div>
                                    <div style="font-weight: bold;">${currentProduct.toLocaleString()}ÂÜÜ</div>
                                </div>
                                <div style="text-align: center; font-size: 11px;">
                                    <div style="color: #ff1493;">Á∑èÂ£≤‰∏ä</div>
                                    <div style="font-weight: bold; color: #ff1493;">${currentTotal.toLocaleString()}ÂÜÜ</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            infoContainer.innerHTML = `
                <div style="color: #ff1493; font-weight: bold; margin-bottom: 10px;">${formattedDate}„ÅÆÂÆüÁ∏æ</div>
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                    <div style="text-align: center; padding: 8px; background: rgba(255, 20, 147, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #ff1493; font-weight: bold;">‚ñ† Á∑èÂ£≤‰∏ä</div>
                        <div style="font-weight: bold; color: #ff1493; font-size: 14px;">${monthData.totalSales.toLocaleString()}ÂÜÜ</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(76, 205, 196, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #4ecdc4; font-weight: bold;">‚ñ† ÊäÄË°ìÂ£≤‰∏ä</div>
                        <div style="font-weight: bold; color: #4ecdc4; font-size: 14px;">${monthData.totalTechSales.toLocaleString()}ÂÜÜ</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255, 165, 0, 0.1); border-radius: 6px; min-width: 70px;">
                        <div style="font-size: 11px; color: #ffa500; font-weight: bold;">‚ñ† Â∫óË≤©Â£≤‰∏ä</div>
                        <div style="font-weight: bold; color: #ffa500; font-size: 14px;">${monthData.totalProductSales.toLocaleString()}ÂÜÜ</div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #666;">ÊåáÂêçÊï∞</div>
                        <div style="font-weight: bold;">${monthData.nominations}‰ª∂</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 12px; color: #666;">Á®ºÂÉçÊó•Êï∞</div>
                        <div style="font-weight: bold;">${monthData.workDays}Êó•</div>
                    </div>
                </div>
                ${realtimeInfo}
            `;
        }
        

        // „É™„Ç¢„É´„Çø„Ç§„É†„Ç∞„É©„ÉïÊõ¥Êñ∞Ôºà„Éá„Éê„Ç¶„É≥„Çπ‰ªò„ÅçÔºâ
        let realtimeUpdateTimeout;
        function updateGraphRealtime() {
            try {
                // ÂâçÂõû„ÅÆ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                clearTimeout(realtimeUpdateTimeout);
                
                // 200msÂæå„Å´ÂÆüË°åÔºàÈÄ£Á∂öÂÖ•ÂäõÊôÇ„ÅÆË≤†Ëç∑ËªΩÊ∏õ„ÄÅ„Çà„Çä„É™„Ç¢„É´„Çø„Ç§„É†Ôºâ
                realtimeUpdateTimeout = setTimeout(() => {
                    console.log('„É™„Ç¢„É´„Çø„Ç§„É†„Ç∞„É©„ÉïÊõ¥Êñ∞ÈñãÂßã');
                    
                    // ÁèæÂú®ÊúàÊ¨°„Çµ„Éû„É™„Éº„Çø„Éñ„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Å¶„ÄÅ„Ç∞„É©„Éï„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„ÅøÊõ¥Êñ∞
                    const monthlyTab = document.getElementById('monthlyAnalysis');
                    if (monthlyTab && monthlyTab.classList.contains('active')) {
                        // ÊúàÊ¨°„Çµ„Éû„É™„Éº„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
                        loadSummaryData();
                        
                        // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
                        setTimeout(() => {
                            generateSimpleChart();
                        }, 100);
                    }
                }, 200);
            } catch (error) {
                console.error('„É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„Ç®„É©„Éº:', error);
            }
        }

        // „Ç∞„É©„ÉïÁ∑ö„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà
        function updateGraphLines() {
            try {
                // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖã„ÇíÂèñÂæó
                const totalCheck = document.getElementById('showTotalSales');
                const techCheck = document.getElementById('showTechSales');
                const productCheck = document.getElementById('showProductSales');
                
                // Á∑öË¶ÅÁ¥†„ÇíÂèñÂæó
                const mainLine = document.getElementById('salesLine');
                const techLine = document.getElementById('techSalesLine');
                const productLine = document.getElementById('productSalesLine');
                
                // Á∑èÂ£≤‰∏äÁ∑öÔºà„É°„Ç§„É≥„É©„Ç§„É≥Ôºâ„ÅØÂ∏∏„Å´Ë°®Á§∫
                if (mainLine) {
                    mainLine.style.display = (totalCheck && totalCheck.checked) ? 'block' : 'block'; // Â∏∏„Å´Ë°®Á§∫
                }
                
                // ÊäÄË°ìÂ£≤‰∏äÁ∑ö
                if (techLine) {
                    techLine.style.display = (techCheck && techCheck.checked) ? 'block' : 'none';
                }
                
                // Â∫óË≤©Â£≤‰∏äÁ∑ö
                if (productLine) {
                    productLine.style.display = (productCheck && productCheck.checked) ? 'block' : 'none';
                }
                
                console.log('„Ç∞„É©„ÉïÁ∑öË°®Á§∫Êõ¥Êñ∞ÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('„Ç∞„É©„ÉïÁ∑öË°®Á§∫Âàá„ÇäÊõø„Åà„Ç®„É©„Éº:', error);
            }
        }

        // „Ç´„Çπ„Çø„É†ÊúüÈñì„Ç∞„É©„ÉïÁîüÊàê
        function generateCustomChart() {
            try {
                const startMonth = document.getElementById('chartStartMonth')?.value;
                const endMonth = document.getElementById('chartEndMonth')?.value;
                
                if (!startMonth || !endMonth) {
                    alert('ÈñãÂßãÊúà„Å®ÁµÇ‰∫ÜÊúà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                
                if (startMonth > endMonth) {
                    alert('ÈñãÂßãÊúà„ÅØÁµÇ‰∫ÜÊúà„Çà„ÇäÂâç„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                
                console.log('„Ç´„Çπ„Çø„É†ÊúüÈñì„Ç∞„É©„ÉïÁîüÊàê:', startMonth, '„Äú', endMonth);
                
                const customData = [];
                const startDate = new Date(startMonth + '-01');
                const endDate = new Date(endMonth + '-01');
                
                let currentDate = new Date(startDate);
                
                while (currentDate <= endDate) {
                    const targetMonthStr = currentDate.toISOString().substr(0, 7);
                    const monthData = getMonthData(targetMonthStr);
                    
                    customData.push({
                        month: targetMonthStr,
                        monthName: currentDate.toLocaleDateString('ja-JP', {month: 'short'}),
                        fullDate: new Date(currentDate),
                        totalSales: monthData.totalSales,
                        totalTechSales: monthData.totalTechSales,
                        totalProductSales: monthData.totalProductSales,
                        nominations: monthData.totalNominations,
                        workDays: monthData.workDays
                    });
                    
                    // Ê¨°„ÅÆÊúà„Å´ÈÄ≤„ÇÄ
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
                
                console.log('„Ç´„Çπ„Çø„É†ÊúüÈñì„Éá„Éº„Çø:', customData);
                
                if (customData.length === 0) {
                    alert('ÊåáÂÆö„Åó„ÅüÊúüÈñì„Å´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ');
                    return;
                }
                
                // „Ç∞„É©„Éï„ÇíÊèèÁîª
                drawLineChart(customData);
                
            } catch (error) {
                console.error('„Ç´„Çπ„Çø„É†ÊúüÈñì„Ç∞„É©„Éï„Ç®„É©„Éº:', error);
                alert('„Ç´„Çπ„Çø„É†ÊúüÈñì„Ç∞„É©„Éï„ÅÆÁîüÊàê„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        
        // ÂçòÊúà„Éá„Éº„ÇøÂèñÂæó
        function getMonthData(targetMonthStr) {
            const targetDate = new Date(targetMonthStr + '-01');
            const monthName = targetDate.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'short'
            });
            
            // Ë©≤ÂΩìÊúà„ÅÆÊó•Â†±„Éá„Éº„Çø„ÇíÂèñÂæó
            const reports = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(`dailyReport_${currentUser}_${targetMonthStr}`)) {
                    const data = JSON.parse(localStorage.getItem(key));
                    reports.push(data);
                }
            }
            
            // ÁèæÂú®ÂÖ•Âäõ‰∏≠„ÅÆ„Éá„Éº„Çø„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÂèçÊò†Ôºà„Å©„ÅÆÊúà„Åß„ÇÇÔºâ
            const currentTech = parseFloat(document.getElementById('techSales')?.value) || 0;
            const currentProduct = parseFloat(document.getElementById('productSales')?.value) || 0;
            const currentDateInput = document.getElementById('reportDate')?.value;
            
            console.log(`getMonthData: ${targetMonthStr}, ÂÖ•ÂäõÊó•‰ªò: ${currentDateInput}, ÊäÄË°ìÂ£≤‰∏ä: ${currentTech}, Â∫óË≤©Â£≤‰∏ä: ${currentProduct}`);
            
            // ÂÖ•Âäõ‰∏≠„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„ÄÅ„Åù„ÅÆÊúà„ÅÆ„Éá„Éº„Çø„Åß„ÅÇ„ÇãÂ†¥Âêà
            if ((currentTech > 0 || currentProduct > 0) && currentDateInput && currentDateInput.startsWith(targetMonthStr)) {
                console.log(`${targetMonthStr}„Å´ÂÖ•Âäõ‰∏≠„Éá„Éº„Çø„ÇíËøΩÂä†`);
                const existingReport = reports.find(r => r.date === currentDateInput);
                if (!existingReport) {
                    // ‰ªÆ„Éá„Éº„Çø„Å®„Åó„Å¶ËøΩÂä†
                    reports.push({
                        date: currentDateInput,
                        techSales: currentTech,
                        productSales: currentProduct,
                        totalSales: currentTech + currentProduct,
                        nominations: parseInt(document.getElementById('nominations')?.value) || 0,
                        isTemporary: true // ‰∏ÄÊôÇÁöÑ„Å™„Éá„Éº„Çø„Éï„É©„Ç∞
                    });
                    console.log(`‰ªÆ„Éá„Éº„ÇøËøΩÂä†ÂÆå‰∫Ü: ${currentTech + currentProduct}ÂÜÜ`);
                } else {
                    console.log('Êó¢Â≠ò„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Å£„Åü„Åü„ÇÅ„ÄÅ‰ªÆ„Éá„Éº„Çø„ÅØËøΩÂä†„Åó„Å™„ÅÑ');
                }
            }
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®„É≠„Ç∞
            console.log(`${targetMonthStr}: ${reports.length}‰ª∂„ÅÆ„Éá„Éº„Çø`, reports);
            
            // ÊúàÈñìÈõÜË®à„ÇíË®àÁÆó
            let totalSales = 0;
            let totalTechSales = 0;
            let totalProductSales = 0;
            let totalNominations = 0;
            
            reports.forEach(report => {
                totalSales += report.totalSales || 0;
                totalTechSales += report.techSales || 0;
                totalProductSales += report.productSales || 0;
                totalNominations += report.nominations || 0;
            });
            
            console.log(`${targetMonthStr} ÈõÜË®à:`, {totalSales, totalTechSales, totalProductSales});
            
            return {
                month: targetMonthStr,
                monthName: monthName,
                totalSales,
                totalTechSales,
                totalProductSales,
                totalNominations,
                workDays: reports.length
            };
        }
        
        // ÊúüÈñìÈÅ∏ÊäûË°®Á§∫ÂàáÊõøÊ©üËÉΩ
        function toggleChartType() {
            try {
                const customPeriodSelector = document.getElementById('customPeriodSelector');
                
                if (!customPeriodSelector) {
                    console.log('ÊúüÈñìÈÅ∏ÊäûË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                // ÁèæÂú®„ÅÆË°®Á§∫Áä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
                if (customPeriodSelector.style.display === 'none' || !customPeriodSelector.style.display) {
                    // ÊúüÈñìÈÅ∏Êäû„ÇíË°®Á§∫
                    customPeriodSelector.style.display = 'block';
                    
                    // „Éá„Éï„Ç©„É´„Éà„ÅÆÊúüÈñì„ÇíË®≠ÂÆöÔºàÈÅéÂéª6„É∂ÊúàÔºâ
                    const today = new Date();
                    const endMonth = today.toISOString().substr(0, 7);
                    const startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 5);
                    const startMonth = startDate.toISOString().substr(0, 7);
                    
                    document.getElementById('chartStartMonth').value = startMonth;
                    document.getElementById('chartEndMonth').value = endMonth;
                } else {
                    // ÊúüÈñìÈÅ∏Êäû„ÇíÈùûË°®Á§∫
                    customPeriodSelector.style.display = 'none';
                    
                    // „Éá„Éï„Ç©„É´„Éà„ÅÆ12„É∂ÊúàË°®Á§∫„Å´Êàª„Åô
                    generateSimpleChart();
                }
            } catch (error) {
                console.error('Ë°®Á§∫ÂàáÊõø„Ç®„É©„Éº:', error);
                alert('Ë°®Á§∫ÂàáÊõø„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        
        // Chart.jsÁâà„Ç∞„É©„Éï‰ΩúÊàê
        function createChartJS() {
            const canvas = document.getElementById('salesTrendChart');
            
            if (!canvas) {
                console.log('CanvasË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('Chart.jsÁâà‰ΩúÊàêË©¶Ë°å');
            
            try {
                if (window.salesTrendChart) {
                    window.salesTrendChart.destroy();
                }
                
                window.salesTrendChart = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'Â£≤‰∏ä',
                            data: [100000, 150000, 120000, 180000, 200000, 170000],
                            borderColor: '#ff1493',
                            backgroundColor: 'rgba(255, 20, 147, 0.1)',
                            fill: true
                        }]
                    }
                });
                console.log('Chart.js‰ΩúÊàêÊàêÂäü');
            } catch (error) {
                console.log('Chart.js„Ç®„É©„Éº:', error);
                alert('Chart.js„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇHTML„Ç∞„É©„Éï„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ');
                toggleChartType();
            }
        }

        // Â£≤‰∏ä„ÉÅ„É£„Éº„Éà‰ΩúÊàêÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
        function createSalesChart(canvas, monthlyData, title) {
            console.log('„Ç∑„É≥„Éó„É´„ÉÅ„É£„Éº„Éà‰ΩúÊàêÈñãÂßã:', title);
            console.log('ÊúàÊ¨°„Éá„Éº„Çø:', monthlyData);
            
            if (!canvas) {
                console.log('ERROR: canvasË¶ÅÁ¥†„Åånull');
                return;
            }
            
            // „Éá„Éº„Çø„Çí„Ç∑„É≥„Éó„É´„Å´Ê∫ñÂÇô
            const labels = [];
            const totalSalesData = [];
            
            monthlyData.forEach(data => {
                labels.push(data.monthName || 'Êú™Ë®≠ÂÆö');
                totalSalesData.push(data.totalSales || 0);
            });
            
            console.log('„Ç∑„É≥„Éó„É´„É©„Éô„É´:', labels);
            console.log('„Ç∑„É≥„Éó„É´Á∑èÂ£≤‰∏ä„Éá„Éº„Çø:', totalSalesData);
            
            // ÊúÄ„ÇÇ„Ç∑„É≥„Éó„É´„Å™Chart.jsË®≠ÂÆö
            try {
                window.salesTrendChart = new Chart(canvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Á∑èÂ£≤‰∏ä',
                            data: totalSalesData,
                            borderColor: '#ff1493',
                            backgroundColor: 'rgba(255, 20, 147, 0.2)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                console.log('Chart‰ΩúÊàêÊàêÂäü');
            } catch (error) {
                console.log('Chart‰ΩúÊàê„Ç®„É©„Éº:', error);
            }
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function logout() {
            currentUser = null;
            isAdmin = false;
            showScreen('loginScreen');
        }
        // „Éá„Éº„Çø„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉªÂæ©ÂÖÉÊ©üËÉΩ
        
        // ÂÖ®„Éá„Éº„Çø„ÇíJSON„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportAllData() {
            const allData = {};
            
            // localStorage„ÅÆÂÖ®„Éá„Éº„Çø„ÇíÂèñÂæó
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                allData[key] = value;
            }
            
            // JSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const dataBlob = new Blob([JSON.stringify(allData, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `salon-data-backup-${new Date().toISOString().substr(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Á¢∫Ë™ç„É°„ÉÉ„Çª„Éº„Ç∏
                    if (confirm('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÅãÔºü\nÔºàÊó¢Â≠ò„Éá„Éº„Çø„ÅØ‰øùÊåÅ„Åï„Çå„ÄÅÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅåËøΩÂä†„ÉªÊõ¥Êñ∞„Åï„Çå„Åæ„ÅôÔºâ')) {
                        // „Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
                        Object.keys(data).forEach(key => {
                            localStorage.setItem(key, data[key]);
                        });
                        
                        alert('„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„ÅüÔºÅ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Åæ„Åô„ÄÇ');
                        location.reload();
                    }
                } catch (error) {
                    alert('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // ========================================
        // FirebaseÁµ±Âêà„Ç≥„Éº„Éâ
        // ========================================
        
        // FirebaseË®≠ÂÆöÔºàFirebase Console„Åã„ÇâÂèñÂæó„Åó„ÅüË®≠ÂÆö„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", 
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // FirebaseÂàùÊúüÂåñ
        let db = null;
        try {
            // FirebaseË®≠ÂÆö„ÅåÊ≠£„Åó„ÅÑÂ†¥Âêà„ÅÆ„ÅøÂàùÊúüÂåñ
            if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('FirebaseÊé•Á∂öÊàêÂäü');
                showFirebaseStatus('connected');
            } else {
                console.log('FirebaseË®≠ÂÆöÂæÖ„Å° - „É≠„Éº„Ç´„É´„É¢„Éº„Éâ„ÅßÂãï‰Ωú');
                showFirebaseStatus('offline');
            }
        } catch (error) {
            console.log('FirebaseÊé•Á∂ö„Ç®„É©„Éº - „É≠„Éº„Ç´„É´„É¢„Éº„Éâ„ÅßÂãï‰Ωú:', error);
            showFirebaseStatus('offline');
        }

        // FirebaseÊé•Á∂öÁä∂ÊÖãË°®Á§∫
        function showFirebaseStatus(status) {
            // Êó¢Â≠ò„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÂâäÈô§
            const existingStatus = document.querySelector('.firebase-status');
            if (existingStatus) existingStatus.remove();
            
            const statusDiv = document.createElement('div');
            statusDiv.className = 'firebase-status';
            statusDiv.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 12px;
                font-weight: bold;
                z-index: 1000;
                ${status === 'connected' 
                    ? 'background: #4CAF50; color: white;' 
                    : status === 'syncing' 
                    ? 'background: #FF9800; color: white;'
                    : 'background: #f44336; color: white;'}
            `;
            statusDiv.textContent = status === 'connected' 
                ? 'üîÑ ÂêåÊúüON' 
                : status === 'syncing'
                ? 'üì§ ÂêåÊúü‰∏≠...'
                : 'üì± „É≠„Éº„Ç´„É´';
            document.body.appendChild(statusDiv);
        }

        // „Éá„Éê„Ç§„ÇπË≠òÂà•Áî®IDÁîüÊàê
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // Firestore„Å´„Éá„Éº„Çø‰øùÂ≠ò
        async function saveToFirestore(collection, data) {
            if (!db) return false;
            
            try {
                showFirebaseStatus('syncing');
                await db.collection(collection).add({
                    ...data,
                    deviceId: getDeviceId(),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                showFirebaseStatus('connected');
                return true;
            } catch (error) {
                console.error('Firebase‰øùÂ≠ò„Ç®„É©„Éº:', error);
                showFirebaseStatus('offline');
                return false;
            }
        }

        // Firestore„Åã„Çâ„Éá„Éº„ÇøÂèñÂæó
        async function getFromFirestore(collection, limit = 100) {
            if (!db) return [];
            
            try {
                const snapshot = await db.collection(collection)
                    .orderBy('timestamp', 'desc')
                    .limit(limit)
                    .get();
                
                const data = [];
                snapshot.forEach(doc => {
                    const docData = doc.data();
                    // timestamp„ÇíJavaScript Date„Å´Â§âÊèõ
                    if (docData.timestamp && docData.timestamp.toDate) {
                        docData.timestamp = docData.timestamp.toDate();
                    }
                    data.push({ id: doc.id, ...docData });
                });
                return data;
            } catch (error) {
                console.error('FirebaseÂèñÂæó„Ç®„É©„Éº:', error);
                return [];
            }
        }

        // Êó•Â†±„Éá„Éº„Çø„ÇíFirebase„Å´ÂêåÊúü
        async function syncDailyReportsToFirebase() {
            if (!db) return;
            
            const reports = JSON.parse(localStorage.getItem('dailyReports') || '{}');
            
            for (const [date, report] of Object.entries(reports)) {
                // Êó¢Â≠ò„Éá„Éº„Çø„ÉÅ„Çß„ÉÉ„ÇØÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
                try {
                    const existingQuery = await db.collection('daily_reports')
                        .where('date', '==', date)
                        .where('employeeName', '==', report.employeeName)
                        .where('deviceId', '==', getDeviceId())
                        .get();
                    
                    if (existingQuery.empty) {
                        await saveToFirestore('daily_reports', {
                            date: date,
                            employeeName: report.employeeName,
                            sales: report.sales || 0,
                            technicalSales: report.technicalSales || 0,
                            retailSales: report.retailSales || 0,
                            customerCount: report.customerCount || 0,
                            instagramUpdated: report.instagramUpdated || false,
                            tiktokUpdated: report.tiktokUpdated || false,
                            memo: report.memo || ''
                        });
                    }
                } catch (error) {
                    console.error('ÂêåÊúü„Ç®„É©„Éº:', error);
                }
            }
        }

        // Firebase„Åã„ÇâÊó•Â†±„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„É≠„Éº„Ç´„É´„Å´ÂèçÊò†
        async function syncDailyReportsFromFirebase() {
            if (!db) return;
            
            try {
                const firestoreReports = await getFromFirestore('daily_reports');
                const localReports = JSON.parse(localStorage.getItem('dailyReports') || '{}');
                
                // Firestore„ÅÆ„Éá„Éº„Çø„Çí„É≠„Éº„Ç´„É´„Å´„Éû„Éº„Ç∏
                firestoreReports.forEach(report => {
                    const key = report.date;
                    // „Çà„ÇäÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„Åæ„Åü„ÅØÂ≠òÂú®„Åó„Å™„ÅÑ„Éá„Éº„Çø„ÅÆ„ÅøÊõ¥Êñ∞
                    if (!localReports[key] || 
                        (report.timestamp && new Date(report.timestamp) > new Date(localReports[key].lastUpdated || 0))) {
                        localReports[key] = {
                            employeeName: report.employeeName,
                            sales: report.sales || 0,
                            technicalSales: report.technicalSales || 0,
                            retailSales: report.retailSales || 0,
                            customerCount: report.customerCount || 0,
                            instagramUpdated: report.instagramUpdated || false,
                            tiktokUpdated: report.tiktokUpdated || false,
                            memo: report.memo || '',
                            lastUpdated: report.timestamp ? report.timestamp.getTime() : Date.now()
                        };
                    }
                });
                
                localStorage.setItem('dailyReports', JSON.stringify(localReports));
                
                // ÁîªÈù¢Êõ¥Êñ∞
                if (typeof loadDailyReport === 'function') {
                    loadDailyReport();
                }
                if (typeof loadMonthlySummary === 'function') {
                    loadMonthlySummary();
                }
            } catch (error) {
                console.error('FirebaseÂêåÊúü„Ç®„É©„Éº:', error);
            }
        }

        // ÁõÆÊ®ô„Éá„Éº„Çø„ÅÆÂêåÊúü
        async function syncGoalsData() {
            if (!db) return;
            
            const goals = JSON.parse(localStorage.getItem('monthlyGoals') || '{}');
            
            for (const [key, goal] of Object.entries(goals)) {
                try {
                    const existingQuery = await db.collection('monthly_goals')
                        .where('monthKey', '==', key)
                        .where('deviceId', '==', getDeviceId())
                        .get();
                    
                    if (existingQuery.empty) {
                        await saveToFirestore('monthly_goals', {
                            monthKey: key,
                            totalSales: goal.totalSales || 0,
                            technicalSales: goal.technicalSales || 0,
                            retailSales: goal.retailSales || 0,
                            customerCount: goal.customerCount || 0,
                            instagramGoal: goal.instagramGoal || 0,
                            tiktokGoal: goal.tiktokGoal || 0
                        });
                    }
                } catch (error) {
                    console.error('ÁõÆÊ®ôÂêåÊúü„Ç®„É©„Éº:', error);
                }
            }
        }

        // ÂÆåÂÖ®ÂêåÊúüÂÆüË°å
        async function performFullSync() {
            if (!db || !navigator.onLine || firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                console.log('FirebaseÊú™Ë®≠ÂÆö - ÂêåÊúü„Çπ„Ç≠„ÉÉ„Éó');
                return;
            }
            
            console.log('üîÑ „Éï„É´ÂêåÊúüÈñãÂßã...');
            showFirebaseStatus('syncing');
            
            try {
                // ÂèåÊñπÂêëÂêåÊúü
                await Promise.all([
                    syncDailyReportsToFirebase(),    // „É≠„Éº„Ç´„É´ ‚Üí Firebase
                    syncDailyReportsFromFirebase(),  // Firebase ‚Üí „É≠„Éº„Ç´„É´
                    syncGoalsData()                  // ÁõÆÊ®ô„Éá„Éº„ÇøÂêåÊúü
                ]);
                
                console.log('‚úÖ ÂêåÊúüÂÆå‰∫Ü');
                showFirebaseStatus('connected');
                
                // ÂêåÊúüÂÆå‰∫ÜÈÄöÁü•Ôºà„É¶„Éº„Ç∂„Éº„Å´Ë¶ã„Åà„ÇãÂΩ¢„ÅßÔºâ
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50px;
                    right: 10px;
                    background: #4CAF50;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 14px;
                    z-index: 1001;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = '‚úÖ „Éá„Éº„ÇøÂêåÊúüÂÆå‰∫Ü';
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
                
            } catch (error) {
                console.error('ÂêåÊúü„Ç®„É©„Éº:', error);
                showFirebaseStatus('offline');
            }
        }

        // Êó¢Â≠ò„ÅÆÊó•Â†±‰øùÂ≠òÊ©üËÉΩ„Å´FirebaseÂêåÊúü„ÇíËøΩÂä†
        const originalSaveDailyReport = window.saveDailyReport;
        window.saveDailyReport = async function() {
            // ÂÖÉ„ÅÆ‰øùÂ≠òÂá¶ÁêÜ„ÇíÂÆüË°å
            if (originalSaveDailyReport) {
                originalSaveDailyReport.call(this);
            }
            
            // FirebaseÂêåÊúü
            setTimeout(async () => {
                await syncDailyReportsToFirebase();
            }, 100);
        };

        // Ëá™ÂãïÂêåÊúüÔºà10ÂàÜ„Åä„ÅçÔºâ
        setInterval(async () => {
            if (navigator.onLine && db && firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                await performFullSync();
            }
        }, 10 * 60 * 1000);

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÂõûÂêåÊúü
        window.addEventListener('load', async () => {
            // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶DOMÊ∫ñÂÇô„ÇíÂæÖ„Å§
            setTimeout(async () => {
                if (navigator.onLine && db && firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
                    await performFullSync();
                }
            }, 2000);
        });

        // „Ç™„É≥„É©„Ç§„É≥Âæ©Â∏∞ÊôÇ„ÅÆÂêåÊúü
        window.addEventListener('online', async () => {
            console.log('üì∂ „Ç™„É≥„É©„Ç§„É≥Âæ©Â∏∞ - ÂêåÊúüÈñãÂßã');
            showFirebaseStatus('syncing');
            if (db) {
                await performFullSync();
            }
        });

        // „Ç™„Éï„É©„Ç§„É≥ÊôÇ„ÅÆË°®Á§∫Êõ¥Êñ∞
        window.addEventListener('offline', () => {
            console.log('üì± „Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ');
            showFirebaseStatus('offline');
        });

        // ÊâãÂãïÂêåÊúü„Éú„Çø„É≥Ê©üËÉΩÔºàÁÆ°ÁêÜËÄÖÁîªÈù¢Áî®Ôºâ
        window.manualSync = async function() {
            if (firebaseConfig.apiKey === "YOUR_API_KEY_HERE") {
                alert('FirebaseË®≠ÂÆö„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ\n\nË®≠ÂÆöÊñπÊ≥ï:\n1. Firebase Console„Åß„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®≠ÂÆö\n2. Ë®≠ÂÆö„Ç≥„Éº„Éâ„Çíindex.html„Å´Ë≤º„Çä‰ªò„Åë\n\nÁèæÂú®„ÅØ„É≠„Éº„Ç´„É´‰øùÂ≠ò„ÅßÂãï‰Ωú‰∏≠„Åß„Åô„ÄÇ');
                return;
            }
            
            if (!db) {
                alert('FirebaseÊé•Á∂ö„Å´Â§±Êïó„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            if (!navigator.onLine) {
                alert('„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ');
                return;
            }
            
            await performFullSync();
            alert('„Éá„Éº„ÇøÂêåÊúü„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
        };

    </script>
    
    <!-- CSSËøΩÂä†: „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .firebase-status {
            transition: all 0.3s ease;
        }
        
        .sync-button {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .sync-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
    </style>
</body>
</html>
